
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-09-18
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Narrative Generation - HAPI FHIR</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta name="author" content="James Agnew" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />


		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
<link rel="stylesheet" href="syntaxhighlighter/shCore.css" type="text/css"/>
<link rel="stylesheet" href="syntaxhighlighter/shThemeDefault.css" type="text/css"/>
<link rel="shortcut icon" href="http://jamesagnew.github.io/hapi-fhir/images/favicon.png"/>
<link rel="stylesheet" href="hapi.css" type="text/css"/>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
	</head>

	<body class="page-doc_narrative project-hapi-fhir" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="./"><span class="color-highlight">HAPI</span> FHIR</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a></li>
							<li ><a href="https://github.com/jamesagnew/hapi-fhir/" title="GitHub Project"  class="externalLink"><i class="fa fa-github"></i> GitHub Project</a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i>&nbsp;Documentation&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="docindex.html" title="Documentation Index">Documentation Index</a></li>
									<li ><a href="doc_intro.html" title="Introduction">Introduction</a></li>
									<li ><a href="doc_dstu2.html" title="DSTU2 Support / HL7.org Structures">DSTU2 Support / HL7.org Structures</a></li>
									<li class="dropdown-submenu ">
										<a href="doc_fhirobjects.html" title="The Data Model">The Data Model</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_fhirobjects.html" title="Working with Resources">Working with Resources</a></li>
											<li ><a href="doc_resource_references.html" title="Resource References">Resource References</a></li>
											<li ><a href="doc_extensions.html" title="Profiles & Extensions">Profiles & Extensions</a></li>
											<li ><a href="doc_tags.html" title="Tags">Tags</a></li>
											<li ><a href="doc_validation.html" title="Validation">Validation</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="doc_rest_client.html" title="RESTful Client">RESTful Client</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_rest_client.html" title="Fluent/Generic Client">Fluent/Generic Client</a></li>
											<li ><a href="doc_rest_client_annotation.html" title="Annotation Client">Annotation Client</a></li>
											<li ><a href="doc_rest_client_interceptor.html" title="Interceptors (client)">Interceptors (client)</a></li>
											<li ><a href="doc_rest_client_http_config.html" title="Client HTTP Configuration">Client HTTP Configuration</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="doc_rest_server.html" title="RESTful Server">RESTful Server</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_rest_server.html" title="Using RESTful Server">Using RESTful Server</a></li>
											<li ><a href="doc_rest_operations.html" title="RESTful Operations">RESTful Operations</a></li>
											<li class="active"><a href="" title="Narrative Generator">Narrative Generator</a></li>
											<li ><a href="doc_cors.html" title="CORS Support">CORS Support</a></li>
											<li ><a href="doc_rest_server_interceptor.html" title="Interceptors (server)">Interceptors (server)</a></li>
											<li ><a href="doc_server_tester.html" title="Web Testing UI">Web Testing UI</a></li>
										</ul>
									</li>
									<li ><a href="doc_logging.html" title="Logging">Logging</a></li>
									<li ><a href="doc_rest_etag.html" title="ETags">ETags</a></li>
									<li ><a href="doc_jpa.html" title="JPA/Database Server">JPA/Database Server</a></li>
									<li ><a href="doc_android.html" title="Android Support">Android Support</a></li>
									<li class="dropdown-submenu ">
										<a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
										<ul class="dropdown-menu">
											<li ><a href="apidocs/index.html" title="Core API">Core API</a></li>
											<li ><a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a></li>
											<li ><a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a></li>
											<li ><a href="apidocs-hl7org-dstu2/index.html" title="Model API (RI DSTU2)">Model API (RI DSTU2)</a></li>
											<li ><a href="apidocs-jpaserver/index.html" title="JPA Server API">JPA Server API</a></li>
										</ul>
									</li>
									<li ><a href="doc_tinder.html" title="Maven Plugin (hapi-tinder-plugin)">Maven Plugin (hapi-tinder-plugin)</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-support"></i>&nbsp;Get Help&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)" class="externalLink">Google Group (Ask Questions)</a></li>
									<li ><a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)" class="externalLink">Issue Tracker (Report Bugs/Request Features)</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Test Server <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a></li>
									<li ><a href="doc_vagrant.html" title="Vagrant Private Test Server">Vagrant Private Test Server</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
		<div>
			<ul class="breadcrumb">
				<li><a href="index.html" title="HAPI FHIR">HAPI FHIR</a></li>
				<li  class="divider">/</li>
			<li><a href="docindex.html" title="Documentation">Documentation</a></li>
			<li  class="divider">/</li>
				<li>Narrative Generation</li>
				<li class="publishDate version-date pull-right">Last Published: 2015-09-18</li>
				<li class="divider pull-right">|</li>
				<li class="projectVersion version-date pull-right">Version: 1.2</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="Narrative_Generation">Narrative Generation</h2>
 </div> 
 <p> HAPI provides a several ways to add <a class="externalLink" href="http://hl7.org/implement/standards/fhir/narrative.html">Narrative Text</a> to your encoded messages. </p> 
 <p> The simplest way is to simply place the narrative text directly in the resource via the <a href="./apidocs/ca/uhn/fhir/model/api/IResource.html#getText">getText()</a> method. </p> 
 <div class="source"> 
  <pre>Patient pat = new Patient();
pat.getText().setStatus(NarrativeStatusEnum.GENERATED);
pat.getText().setDiv(&quot;&lt;div&gt;This is the narrative text&lt;br/&gt;this is line 2&lt;/div&gt;&quot;);
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Automatic_Narrative_Generartion">Automatic Narrative Generartion</h2> 
 <p> HAPI also comes with a built-in mechanism for automatically generating narratives based on your resources. </p> 
 <p> <b>Warning: </b> This built-in capability is a work in progress, and does not cover every type of resource or even every attribute in any resource. You should test it and configure it for your particular use cases. </p> 
 <p> HAPI's built-in narrative generation uses the <a class="externalLink" href="http://www.thymeleaf.org/">Thymeleaf</a> library for templating narrative texts. Thymeleaf provides a simple XHTML-based syntax which is easy to use and meshes well with the HAPI-FHIR model objects. </p> 
 <div class="section"> 
  <h3 id="A_Simple_Example">A Simple Example</h3> 
  <p> Activating HAPI's built-in narrative generator is as simple as calling <a href="./apidocs/ca/uhn/fhir/context/FhirContext.html#setNarrativeGeneratorca.uhn.fhir.narrative.INarrativeGenerator">setNarrativeGenerator</a>. </p> 
  <div class="source"> 
   <pre>Patient patient = new Patient();
patient.addIdentifier().setSystem(&quot;urn:foo&quot;).setValue(&quot;7000135&quot;);
patient.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;).addGiven(&quot;Edward&quot;);
patient.addAddress().addLine(&quot;742 Evergreen Terrace&quot;).setCity(&quot;Springfield&quot;).setState(&quot;ZZ&quot;);

FhirContext ctx = FhirContext.forDstu2();

// Use the narrative generator
ctx.setNarrativeGenerator(new DefaultThymeleafNarrativeGenerator());

// Encode the output, including the narrative
String output = ctx.newJsonParser().setPrettyPrint(true).encodeResourceToString(patient);
System.out.println(output);
</pre> 
  </div> 
  <p> ...which produces the following output: </p> 
  <div class="source"> 
   <pre>&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
   &lt;text&gt;
      &lt;status value=&quot;generated&quot;/&gt;
      &lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
         &lt;div class=&quot;hapiHeaderText&quot;&gt; John Edward &lt;b&gt;SMITH &lt;/b&gt;&lt;/div&gt;
         &lt;table class=&quot;hapiPropertyTable&quot;&gt;
            &lt;tbody&gt;
               &lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;7000135&lt;/td&gt;&lt;/tr&gt;
               &lt;tr&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;&lt;span&gt;742 Evergreen Terrace&lt;/span&gt;&lt;br/&gt;&lt;span&gt;Springfield&lt;/span&gt; &lt;span&gt;ZZ&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;
            &lt;/tbody&gt;
         &lt;/table&gt;
      &lt;/div&gt;
   &lt;/text&gt;
   &lt;!-- .... snip ..... --&gt;
&lt;/Patient&gt;</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Built-in_Narrative_Templates">Built-in Narrative Templates</h3> 
  <p> HAPI currently only comes with built-in support for a few resource types. Our intention is that people enhance these templates and create new ones, and share these back with us so that we can continue to build out the library. To see the current template library, see the source repository <a class="externalLink" href="https://github.com/jamesagnew/hapi-fhir/tree/master/hapi-fhir-base/src/main/resources/ca/uhn/fhir/narrative">here</a>. </p> 
  <p> Note that these templates expect a few specific CSS definitions to be present in your site's CSS file. See the <a class="externalLink" href="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-base/src/main/resources/ca/uhn/fhir/narrative/hapi-narrative.css">narrative CSS</a> to see these. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Creating_your_own_Templates">Creating your own Templates</h2> 
 <p> To use your own templates for narrative generation, simply create one or more templates, using the Thymeleaf HTML based syntax. </p> 
 <div class="source"> 
  <pre>&lt;div&gt;
	&lt;!-- 
	Normal Thymeleaf tags apply. Here, we loop through each of the 
	identifiers that the practitioner has, and create a DIV tag for
	each one, with the text &quot;Identifier: [value]&quot;
	--&gt;
	&lt;div th:each=&quot;identifier : ${resource.identifier}&quot; th:text=&quot;'Identifier: ' + ${identifier.value}&quot;&gt;&lt;/div&gt;
	
	&lt;!-- 
	HAPI also defines a custom tag attribute, th:narrative=&quot;value&quot;, 
	which is used to render a datatype into more HTML. In the example
	below, the value of ${resource.name} (which is the name property
	of the Practitioner resource, a HumanName datatype instance)
	is rendered, and its contents placed in a DIV tag. That DIV tag is
	then given a .nameElement CSS style.
	 --&gt;
	&lt;h1&gt;Name&lt;/h1&gt;
	&lt;div th:narrative=&quot;${resource.name}&quot; class=&quot;nameElement&quot;&gt;&lt;/div&gt;
	
	&lt;h1&gt;Address&lt;/h1&gt;
	&lt;div th:narrative=&quot;${resource.address}&quot;&gt;&lt;/div&gt;


&lt;/div&gt;
</pre> 
 </div> 
 <p> Then create a properties file which describes your templates. In this properties file, each resource to be defined has a pair or properties. </p> 
 <p> The first (name.class) defines the class name of the resource to define a template for. The second (name.narrative) defines the path/classpath to the template file. The format of this path is <tt>file:/path/foo.html</tt> or <tt>classpath:/com/classpath/foo.html</tt> </p> 
 <div class="source"> 
  <pre># Two property lines in the file per template
practitioner.class=ca.uhn.fhir.model.dstu.resource.Practitioner
practitioner.narrative=file:src/test/resources/narrative/Practitioner.html

observation.class=ca.uhn.fhir.model.dstu.resource.Observation
observation.narrative=file:src/test/resources/narrative/Observation.html

# etc...</pre> 
 </div> 
 <p> You may also override/define behaviour for datatypes. These datatype narrative definitions will be used as content within <tt>th:narrative</tt> blocks in resource templates. See the example resource template above for an example. </p> 
 <div class="source"> 
  <pre># datatypes use the same format as resources
humanname.class=ca.uhn.fhir.model.dstu.composite.HumanNameDt
humanname.narrative=classpath:ca/uhn/fhir/narrative/HumanNameDt.html</pre> 
 </div> 
 <p> Finally, use the <a href="./apidocs/ca/uhn/fhir/narrative/CustomThymeleafNarrativeGenerator.html">CustomThymeleafNarrativeGenerator</a> and provide it to the FhirContext. </p> 
 <div class="source"> 
  <pre>String propFile = &quot;classpath:/com/foo/customnarrative.properties&quot;;
CustomThymeleafNarrativeGenerator gen = new CustomThymeleafNarrativeGenerator(propFile);

FhirContext ctx = FhirContext.forDstu2();
ctx.setNarrativeGenerator(gen);
</pre> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li><a href="#Narrative_Generation" title="Narrative Generation">Narrative Generation</a>
		<li class="dropdown"><a href="#Automatic_Narrative_Generartion" title="Automatic Narrative Generartion">Automatic Narrative Generartion <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#A_Simple_Example" title="A Simple Example">A Simple Example</a>
		<li><a href="#Built-in_Narrative_Templates" title="Built-in Narrative Templates">Built-in Narrative Templates</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Creating_your_own_Templates" title="Creating your own Templates">Creating your own Templates</a>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">HAPI FHIR</li>
						<li >
							<a href="index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a>
						</li>
						<li >
							<a href="changes-report.html" title="Changelog">Changelog</a>
						</li>
						<li >
							<a href="license.html" title="License">License</a>
						</li>
						<li class="nav-header">Test Server</li>
						<li >
							<a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a>
						</li>
						<li >
							<a href="doc_vagrant.html" title="Vagrant Private Test Server">Vagrant Private Test Server</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Using HAPI</li>
						<li >
							<a href="docindex.html" title="Documentation Index">Documentation Index</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">JavaDocs</li>
						<li >
							<a href="apidocs/index.html" title="Core API">Core API</a>
						</li>
						<li >
							<a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a>
						</li>
						<li >
							<a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a>
						</li>
						<li >
							<a href="apidocs-hl7org-dstu2/index.html" title="Model API (RI DSTU2)">Model API (RI DSTU2)</a>
						</li>
						<li >
							<a href="apidocs-jpaserver/index.html" title="JPA Server API">JPA Server API</a>
						</li>
						<li class="nav-header">JXR</li>
						<li >
							<a href="xref-base/index.html" title="Core">Core</a>
						</li>
						<li >
							<a href="xref-jpaserver/index.html" title="JPA Server">JPA Server</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Get Help</li>
						<li >
							<a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)" class="externalLink">Google Group (Ask Questions)</a>
						</li>
						<li >
							<a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)" class="externalLink">Issue Tracker (Report Bugs/Request Features)</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>HAPI FHIR is a Java implementation of the HL7 FHIR
				(Fast Healthcare Interoperable Resources) specification.
				This project is open source (licensed under the Apache Software
				License 2.0) and 100% free to use.<br/><br/>
				<a href="https://github.com/jamesagnew/hapi-fhir"><img src="./images/github-logo-mini.png" alt="Hosted on GitHub" border="0"/></a>
				<br/>
				Star us and we will love you!<br />
				<iframe src="http://ghbtns.com/github-btn.html?user=jamesagnew&repo=hapi-fhir&type=star&count=true" frameborder="0" scrolling="0" width="100px" height="20px"></iframe></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014-2015 <a href="http://www.uhn.ca">University Health Network</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>

	<script src="./js/reflow-skin.js"></script>

	<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>