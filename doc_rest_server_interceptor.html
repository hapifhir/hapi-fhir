
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-02-15
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Server Interceptors - HAPI FHIR</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta name="author" content="James Agnew" />
		<meta http-equiv="content-language" content="en" />

		<link href="https://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />


		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
<link rel="stylesheet" href="syntaxhighlighter/shCore.css" type="text/css"/>
<link rel="stylesheet" href="syntaxhighlighter/shThemeDefault.css" type="text/css"/>
<link rel="shortcut icon" href="http://hapifhir.io/favicon.png"/>
<link rel="stylesheet" href="hapi.css" type="text/css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
	</head>

	<body class="page-doc_rest_server_interceptor project-hapi-fhir" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://hapifhir.io/"><span class="color-highlight">HAPI</span> FHIR</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="https://smilecdr.com/blog" title="Blog" class="externalLink">Blog</a></li>
							<li ><a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a></li>
							<li ><a href="https://github.com/jamesagnew/hapi-fhir/" title="GitHub Project"  class="externalLink"><i class="fa fa-github"></i> GitHub Project</a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i>&nbsp;Documentation&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="docindex.html" title="Documentation Index">Documentation Index</a></li>
									<li ><a href="doc_intro.html" title="Introduction">Introduction</a></li>
									<li ><a href="doc_dstu2.html" title="DSTU3 Support / HL7.org Structures">DSTU3 Support / HL7.org Structures</a></li>
									<li class="dropdown-submenu ">
										<a href="doc_fhirobjects.html" title="The Data Model">The Data Model</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_fhirobjects.html" title="Working with Resources">Working with Resources</a></li>
											<li ><a href="doc_resource_references.html" title="Resource References">Resource References</a></li>
											<li ><a href="doc_extensions.html" title="Profiles & Extensions">Profiles & Extensions</a></li>
											<li ><a href="doc_tags.html" title="Tags">Tags</a></li>
											<li ><a href="doc_validation.html" title="Validation">Validation</a></li>
											<li ><a href="doc_custom_structures.html" title="Custom Structures">Custom Structures</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="doc_rest_client.html" title="RESTful Client">RESTful Client</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_rest_client.html" title="Fluent/Generic Client">Fluent/Generic Client</a></li>
											<li ><a href="doc_rest_client_annotation.html" title="Annotation Client">Annotation Client</a></li>
											<li ><a href="doc_rest_client_interceptor.html" title="Interceptors (client)">Interceptors (client)</a></li>
											<li ><a href="doc_rest_client_http_config.html" title="Client Configuration">Client Configuration</a></li>
											<li ><a href="doc_rest_client_examples.html" title="Client Examples">Client Examples</a></li>
											<li ><a href="doc_rest_client_alternate_provider.html" title="JAX-RS Client & Alternate HTTP Providers">JAX-RS Client & Alternate HTTP Providers</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="doc_rest_server.html" title="RESTful Server">RESTful Server</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_rest_server.html" title="Using RESTful Server">Using RESTful Server</a></li>
											<li ><a href="doc_rest_operations.html" title="RESTful Operations">RESTful Operations</a></li>
											<li ><a href="doc_narrative.html" title="Narrative Generator">Narrative Generator</a></li>
											<li class="active"><a href="" title="Interceptors (server)">Interceptors (server)</a></li>
											<li ><a href="doc_rest_server_security.html" title="Security">Security</a></li>
											<li ><a href="doc_cors.html" title="CORS Support">CORS Support</a></li>
											<li ><a href="doc_server_tester.html" title="Web Testing UI">Web Testing UI</a></li>
											<li ><a href="doc_rest_server_jaxrs.html" title="JAX-RS Support">JAX-RS Support</a></li>
										</ul>
									</li>
									<li ><a href="doc_logging.html" title="Logging">Logging</a></li>
									<li ><a href="doc_rest_etag.html" title="ETags">ETags</a></li>
									<li ><a href="doc_jpa.html" title="JPA/Database Server">JPA/Database Server</a></li>
									<li ><a href="doc_android.html" title="Android Support">Android Support</a></li>
									<li class="dropdown-submenu ">
										<a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
										<ul class="dropdown-menu">
											<li ><a href="apidocs/index.html" title="Core API">Core API</a></li>
											<li ><a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a></li>
											<li ><a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a></li>
											<li ><a href="apidocs-dstu3/index.html" title="Model API (DSTU3)">Model API (DSTU3)</a></li>
											<li ><a href="apidocs-jpaserver/index.html" title="JPA Server API">JPA Server API</a></li>
										</ul>
									</li>
									<li ><a href="doc_cli.html" title="Command Line Tool (hapi-fhir-cli)">Command Line Tool (hapi-fhir-cli)</a></li>
									<li ><a href="doc_tinder.html" title="Maven Plugin (hapi-tinder-plugin)">Maven Plugin (hapi-tinder-plugin)</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-support"></i>&nbsp;Get Help&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)" class="externalLink">Google Group (Ask Questions)</a></li>
									<li ><a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)" class="externalLink">Issue Tracker (Report Bugs/Request Features)</a></li>
									<li ><a href="hapi-fhir-faq.html" title="Frequently Asked Questions (FAQ)">Frequently Asked Questions (FAQ)</a></li>
									<li ><a href="https://chat.fhir.org/" title="FHIR.org Chat (Live Chat with FHIR Implementors)" class="externalLink">FHIR.org Chat (Live Chat with FHIR Implementors)</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Test Server <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
		<div>
			<ul class="breadcrumb">
				<li><a href="index.html" title="HAPI FHIR">HAPI FHIR</a></li>
				<li  class="divider">/</li>
			<li><a href="docindex.html" title="Documentation">Documentation</a></li>
			<li  class="divider">/</li>
				<li>Server Interceptors</li>
				<li class="publishDate version-date pull-right">Last Published: 2017-02-15</li>
				<li class="divider pull-right">|</li>
				<li class="projectVersion version-date pull-right">Version: 2.3-SNAPSHOT</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<!-- The body of the document contains a number of sections --> 
<div class="section"> 
 <div class="page-header">
  <h2 id="Server_Interceptors">Server Interceptors</h2>
 </div> 
 <p> The RESTful server provides a powerful mechanism for adding cross-cutting behaviour (e.g. requests, such as authnorization, auditing, fancy output, logging, etc.) to each incoming request that it processes. This mechanism consists of defining one or more <b>interceptors</b> that will be invoked at defined points in the processing of each incoming request. </p> 
 <img src="svg/restful-server-interceptors.svg" alt="Interceptors" /> 
 <p> Interceptors will intercept the incoming request, and can take action such as logging or auditing it, or examining/injecting headers. They can optionally choose to handle the request directly and the cancel any subsequent processing (in other words, the interceptor can choose to supply a response to the client, and can then signal to the server that it does not need to do so). </p> 
 <p> Interceptors may also be notified of responses prior to those responses being served to a client, and may audit or even cancel the response. The diagram on the right shows the lifecycle of a normal (non failing) request which is subject to an interceptor. </p> 
 <p> Interceptors must implement the <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/IServerInterceptor.html">IServerInterceptor</a> interface (or extend the convenience <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/InterceptorAdapter.html">InterceptorAdapter</a> class provided). The RESTful server will normally invoke the interceptor at several points in the execution of the client request. </p> 
 <ul> 
  <li> Before any processing at all is performed on the request, <b>incomingRequestPreProcessed</b> will be invoked. This can be useful if you wish to handle some requests completely outside of HAPI's processing mechanism. 
   <ul> 
    <li> If this method returns <tt>true</tt>, processing continues to the next interceptor, and ultimately to the next phase of processing. </li> 
    <li> If this method returns <tt>false</tt>, processing stops immediately. This is useful if the interceptor wishes to supply its own response by directly calling methods on the <tt>HttpServletResponse</tt> </li> 
    <li> If this method throws any subclass of <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a>, processing is stopped immedicately and the corresponding status is returned to the client. This is useful if an interceptor wishes to abort the request (e.g. because it did not detect valid credentials) </li> 
   </ul> </li> 
  <li> Once the request is classified (meaning that the URL and request headers are examined to determine exactly what kind of request is being made), <b>incomingRequestPostProcessed</b> will be invoked. This method has an additional parameter, the <a href="./apidocs/ca/uhn/fhir/rest/method/RequestDetails.html">RequestDetails</a> object which contains details about what operation is about to be called, and what request parameters were receievd with that request. 
   <ul> 
    <li> If this method returns <tt>true</tt>, processing continues to the next interceptor, and ultimately to the next phase of processing. </li> 
    <li> If this method returns <tt>false</tt>, processing stops immediately. This is useful if the interceptor wishes to supply its own response by directly calling methods on the <tt>HttpServletResponse</tt> </li> 
    <li> If this method throws any subclass of <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a>, processing is stopped immedicately and the corresponding status is returned to the client. This is useful if an interceptor wishes to abort the request (e.g. because it did not detect valid credentials) </li> 
   </ul> </li> 
  <li> Once the request is being handled, <b>incomingRequestPreHandled</b> will be invoked. This method is useful in that it provides details about the FHIR operation being invoked (e.g. is this a &quot;read&quot; or a &quot;create&quot;? what is the resource type and ID of the resource being accessed, etc.). This method can be useful for adding finer grained access controls. Note that <tt>incomingRequestPreHandled</tt> is not able to directly supply a response, but it may throw a <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a> to abort processing. </li> 
  <li> After the operation is handled (by invoking the corresponding ResourceProvider or PlainProvider method), but before the actual response is returned to the client, the <b>outgoingResponse</b> method is invoked. This method also has details about the request in its parameters, but also receives a copy of the response that is about to be returned. Note that there are three implementations of <b>outgoingResponse</b>: The server will invoke the one which corresponds to the response type of the operation being invoked (resource, bundle, etc.) </li> 
 </ul> 
 <br /> 
 <div class="section"> 
  <h3 id="Exception_Handling">Exception Handling</h3> 
  <img src="svg/restful-server-interceptors-exception.svg" alt="Interceptors" align="right" /> 
  <p> In the event of an exception being thrown within the server, the interceptor method <tt><a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/IServerInterceptor.html#handleExceptionca.uhn.fhir.rest.method.RequestDetails20java.lang.Throwable20javax.servlet.http.HttpServletRequest20javax.servlet.http.HttpServletResponse">handleException</a></tt> will be called. This applies both to HAPI-FHIR defined exceptions thrown within resource provider methods you have created as well as unexpected exceptions such as NullPointerException thrown at any point in the handling chain. </p> 
  <p> In general, you will want to return <tt>true</tt> from the <tt>handleException</tt> method, which means that processing continues normally (RestfulServer will return an HTTP 4xx or 5xx response automatically depending on the specific exception which was thrown). </p> 
  <p> However, you may override the server's built-in exception handling by returning <tt>false</tt>. In this case, you must provide your own response by interacting with the <tt>HttpServletResponse</tt> object which is passed in. </p> 
 </div> 
 <br /> 
 <div class="section"> 
  <h3 id="Registering_Interceptors">Registering Interceptors</h3> 
  <p> To register an interceptor to the server, simply call either <tt>registerInterceptor</tt> or <tt>setInterceptors</tt> on your RestfulServer instance. </p> 
  <p> Note that order is important: The server will invoke <tt>incomingRequestPreProcessed</tt> and <tt>incomingRequestPostProcessed</tt> in the same order that they are registered to the server. The server will invoke <tt>outgoingResponse</tt> in the <b>reverse</b> order to the order in which the interceptors were registered. This means that interceptors can be thought of as &quot;wrapping&quot; the request. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Built_In_Interceptors">Built In Interceptors</h2> 
 <p> HAPI also provides built-in interceptors which may be useful. Links to the code for each interceptor is also provided, to give examples of how interceptors are written. </p> 
 <a name="Logging"></a> 
 <div class="section"> 
  <h3 id="Logging_Server_Requests">Logging Server Requests</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/LoggingInterceptor.html">LoggingInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/LoggingInterceptor.html">code</a>) can be used to generate a new log line (via SLF4j) for each incoming request. LoggingInterceptor provides a flexible message format that can be used to provide a customized level of detail about each incoming request. </p> 
  <p> The following example shows how to register a logging interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { &quot;/fhir/*&quot; }, displayName = &quot;FHIR Server&quot;)
   public class RestfulServerWithLogging extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...
         
         // Now register the logging interceptor
         LoggingInterceptor loggingInterceptor = new LoggingInterceptor();
         registerInterceptor(loggingInterceptor);

         // The SLF4j logger &quot;test.accesslog&quot; will receive the logging events 
         loggingInterceptor.setLoggerName(&quot;test.accesslog&quot;);
         
         // This is the format for each line. A number of substitution variables may
         // be used here. See the JavaDoc for LoggingInterceptor for information on
         // what is available.
         loggingInterceptor.setMessageFormat(&quot;Source[${remoteAddr}] Operation[${operationType} ${idOrResourceName}] UA[${requestHeader.user-agent}] Params[${requestParameters}]&quot;);
         
      }
      
   }
</pre> 
  </div> 
  <p> This interceptor will then produce output similar to the following: </p> 
  <div class="source"> 
   <pre>2014-09-04 02:37:30.030 Source[127.0.0.1] Operation[vread Patient/1667/_history/1] UA[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.94 Safari/537.36] Params[?_format=json]
2014-09-04 03:30:00.443 Source[127.0.0.1] Operation[search-type Organization] UA[Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)] Params[]</pre> 
  </div> 
 </div> 
 <a name="ExceptionHandlingInterceptor"></a> 
 <div class="section"> 
  <h3 id="Exception_Handling">Exception Handling</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/ExceptionHandlingInterceptor.html">ExceptionHandlingInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/ExceptionHandlingInterceptor.html">code</a>) can be used to customize what is returned to the client and what is logged when the server throws an exception for any reason (including routine things like UnprocessableEntityExceptions thrown as a matter of normal processing in a create method, but also including unexpected NullPointerExceptions thrown by client code). </p> 
  <p> The following example shows how to register an exception handling interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { &quot;/fhir/*&quot; }, displayName = &quot;FHIR Server&quot;)
   public class RestfulServerWithExceptionHandling extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...
         
         // Now register the interceptor
         ExceptionHandlingInterceptor interceptor = new ExceptionHandlingInterceptor();
         registerInterceptor(interceptor);

         // Return the stack trace to the client for the following exception types
         interceptor.setReturnStackTracesForExceptionTypes(InternalErrorException.class, NullPointerException.class);
         
      }
      
   }
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Response_Syntax_Highlighting">Response Syntax Highlighting</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/ResponseHighlighterInterceptor.html">ResponseHighlighterInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/ResponseHighlighterInterceptor.html">code</a>) detects when a request is coming from a browser and returns HTML with syntax highlighted XML/JSON instead of just the raw text. In other words, if a user uses a browser to request &quot;http://foo/Patient/1&quot; by typing this address into their URL bar, they will get nice formatted HTML back with a human readable version of the content. This is helpful for testers. </p> 
  <p> To see an example of how this looks, see our demo server using the following example query: <a class="externalLink" href="http://fhirtest.uhn.ca/baseDstu2/Patient/">http://fhirtest.uhn.ca/baseDstu2/Patient</a> </p> 
  <p> The following example shows how to register this interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { &quot;/fhir/*&quot; }, displayName = &quot;FHIR Server&quot;)
   public class RestfulServerWithResponseHighlighter extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...
         
         // Now register the interceptor
         ResponseHighlighterInterceptor interceptor = new ResponseHighlighterInterceptor();
         registerInterceptor(interceptor);

      }
      
   }
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="RequestResponse_Validation">Request/Response Validation</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/RequestValidatingInterceptor.html">RequestValidatingInterceptor</a> and <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/ResponseValidatingInterceptor.html">ResponseValidatingInterceptor</a> can be used to perform validation of resources on their way into and out of the server respectively. </p> 
  <p> The RequestValidatingInterceptor looks at resources coming into the server (e.g. for create, update, $operations, transactions, etc.) and validates them. The ResponseValidatingInterceptor looks at resources being returned by the server (e.g. for read, search, $operations, etc.) and validates them. </p> 
  <p> These interceptors can be configured to add headers to the response, fail the response (returning an HTTP 422 and throwing an exception in the process), or to add to the OperationOutcome returned by the server. </p> 
  <p> See the <a href="./doc_validation.html">Validation Page</a> for information on available <a href="./apidocs/ca/uhn/fhir/validation/IValidatorModule.html">IValidatorModule</a> validation modules. Any of the <b>Resource Validators</b> listed on that page can be enabled in these interceptors (note that the <b>Parser Validators</b> can not). </p> 
  <p> The following example shows how to register this interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { &quot;/fhir/*&quot; }, displayName = &quot;FHIR Server&quot;)
   public class ValidatingServerWithLogging extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...

         // Create an interceptor to validate incoming requests
         RequestValidatingInterceptor requestInterceptor = new RequestValidatingInterceptor();
         
         // Register a validator module (you could also use SchemaBaseValidator and/or SchematronBaseValidator)
         requestInterceptor.addValidatorModule(new FhirInstanceValidator());
         
         requestInterceptor.setFailOnSeverity(ResultSeverityEnum.ERROR);
         requestInterceptor.setAddResponseHeaderOnSeverity(ResultSeverityEnum.INFORMATION);
         requestInterceptor.setResponseHeaderValue(&quot;Validation on ${line}: ${message} ${severity}&quot;);
         requestInterceptor.setResponseHeaderValueNoIssues(&quot;No issues detected&quot;);
         
         // Now register the validating interceptor
         registerInterceptor(requestInterceptor);

         // Create an interceptor to validate responses
         // This is configured in the same way as above
         ResponseValidatingInterceptor responseInterceptor = new ResponseValidatingInterceptor();
         responseInterceptor.addValidatorModule(new FhirInstanceValidator());
         responseInterceptor.setFailOnSeverity(ResultSeverityEnum.ERROR);
         responseInterceptor.setAddResponseHeaderOnSeverity(ResultSeverityEnum.INFORMATION);
         responseInterceptor.setResponseHeaderValue(&quot;Validation on ${line}: ${message} ${severity}&quot;);
         responseInterceptor.setResponseHeaderValueNoIssues(&quot;No issues detected&quot;);
         registerInterceptor(responseInterceptor);
      }
      
   }
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="CORS_Cross-Origin_Resource_Sharing">CORS (Cross-Origin Resource Sharing)</h3> 
  <p> HAPI FHIR includes an interceptor which can be used to implement CORS support on your server. See HAPI's <a href="./doc_cors.html">CORS Documentation</a> for information on how to use this interceptor. </p> 
 </div> 
 <div class="section"> 
  <h3 id="Rejecting_Unsupported_HTTP_Verbs">Rejecting Unsupported HTTP Verbs</h3> 
  <p> Some security audit tools require that servers return an HTTP 405 if an unsupported HTTP verb is received (e.g. TRACE). The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/BanUnsupprtedHttpMethodsInterceptor.html">BanUnsupprtedHttpMethodsInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/BanUnsupprtedHttpMethodsInterceptor.html">code</a>) can be used to accomplish this. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Creating_Interceptors">Creating Interceptors</h2> 
 <p> Creating your own interceptors is easy. HAPI-FHIR provides a class called <tt>InterceptorAdapter</tt> which you can extend and then override any methods you wish. The following example shows a simple request counter. </p> 
 <div class="source"> 
  <pre>public class RequestCounterInterceptor extends InterceptorAdapter
{

   private int myRequestCount;

   public int getRequestCount() {
      return myRequestCount;
   }

   /**
    * Override the incomingRequestPreProcessed method, which is called
    * for each incoming request before any processing is done
    */
   @Override
   public boolean incomingRequestPreProcessed(HttpServletRequest theRequest, HttpServletResponse theResponse) {
      myRequestCount++;
      return true;
   }
   
}
</pre> 
 </div> 
 <p> The following example shows an exception handling interceptor which overrides the built-in exception handling by providing a custom response. </p> 
 <div class="source"> 
  <pre>public class RequestExceptionInterceptor extends InterceptorAdapter
{

   @Override
   public boolean handleException(RequestDetails theRequestDetails, BaseServerResponseException theException, HttpServletRequest theServletRequest,
         HttpServletResponse theServletResponse) throws ServletException, IOException {
      
      // HAPI's server exceptions know what the appropriate HTTP status code is
      theServletResponse.setStatus(theException.getStatusCode());
      
      // Provide a response ourself
      theServletResponse.setContentType(&quot;text/plain&quot;);
      theServletResponse.getWriter().append(&quot;Failed to process!&quot;);
      theServletResponse.getWriter().close();
      
      // Since we handled this response in the interceptor, we must return false
      // to stop processing immediately
      return false;
   }


}
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="JPA_Server_Interceptors">JPA Server Interceptors</h2> 
 <p> The HAPI <a href="./doc_jpa.html">JPA Server</a> is an added layer on top of the HAPI REST server framework. When you </p> 
 <p> When an interceptor is registered against a RestfulServer which is backed by the HAPI JPA Server, the <tt>incomingRequestPreHandled</tt> method will be called once for most operations (e.g. a FHIR <tt>create</tt>), but in the case where the client performs a FHIR <tt>transaction</tt> that method might be called multiple times over the course of a single client invocation. For example if the transaction contained a single create, the <tt>incomingRequestPreHandled</tt> method will be called twice: once to indicate the transaction, and once to indicate the create. </p> 
 <p> This behaviour can be useful in cases where you want to audit exactly what was done over the course of a request. Since a transaction can contain creates, updates, and even more nested transactions, this behaviour ensures that you are notified for each activity. </p> 
 <p> You may also choose to create interceptors which implement the more specialized <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/IServerOperationInterceptor.html">IJpaServerInterceptor</a> interface, as this interceptor adds additional methods which are called during the JPA lifecycle. </p> 
 <p> Note that this documentation used to <b>erroneously</b> suggest that in order to achieve this behaviour you needed to register the interceptor with the DaoConfig. In actual fact this did not make any difference, and registering interceptors with the DaoConfig has now been deprecated since it does not achieve anything extra. </p> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#Server_Interceptors" title="Server Interceptors">Server Interceptors <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Exception_Handling" title="Exception Handling">Exception Handling</a>
		<li><a href="#Registering_Interceptors" title="Registering Interceptors">Registering Interceptors</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#Built_In_Interceptors" title="Built In Interceptors">Built In Interceptors <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Logging_Server_Requests" title="Logging Server Requests">Logging Server Requests</a>
		<li><a href="#Exception_Handling" title="Exception Handling">Exception Handling</a>
		<li><a href="#Response_Syntax_Highlighting" title="Response Syntax Highlighting">Response Syntax Highlighting</a>
		<li><a href="#RequestResponse_Validation" title="Request/Response Validation">Request/Response Validation</a>
		<li><a href="#CORS_Cross-Origin_Resource_Sharing" title="CORS (Cross-Origin Resource Sharing)">CORS (Cross-Origin Resource Sharing)</a>
		<li><a href="#Rejecting_Unsupported_HTTP_Verbs" title="Rejecting Unsupported HTTP Verbs">Rejecting Unsupported HTTP Verbs</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Creating_Interceptors" title="Creating Interceptors">Creating Interceptors</a>
		<li><a href="#JPA_Server_Interceptors" title="JPA Server Interceptors">JPA Server Interceptors</a>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">HAPI FHIR</li>
						<li >
							<a href="index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a>
						</li>
						<li >
							<a href="changes-report.html" title="Changelog">Changelog</a>
						</li>
						<li >
							<a href="license.html" title="License">License</a>
						</li>
						<li class="nav-header">Test Server</li>
						<li >
							<a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Using HAPI</li>
						<li >
							<a href="docindex.html" title="Documentation Index">Documentation Index</a>
						</li>
						<li >
							<a href="doc_cli.html" title="Command Line Tool (cli)">Command Line Tool (cli)</a>
						</li>
						<li class="nav-header">Contribute</li>
						<li >
							<a href="hacking_hapi_fhir.html" title="Guide to Hacking HAPI">Guide to Hacking HAPI</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">JavaDocs</li>
						<li >
							<a href="apidocs/index.html" title="Core API">Core API</a>
						</li>
						<li >
							<a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a>
						</li>
						<li >
							<a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a>
						</li>
						<li >
							<a href="apidocs-dstu3/index.html" title="Model API (DSTU3)">Model API (DSTU3)</a>
						</li>
						<li >
							<a href="apidocs-jpaserver/index.html" title="JPA Server API">JPA Server API</a>
						</li>
						<li class="nav-header">JXR</li>
						<li >
							<a href="xref-base/index.html" title="Core">Core</a>
						</li>
						<li >
							<a href="xref-jpaserver/index.html" title="JPA Server">JPA Server</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Get Help</li>
						<li >
							<a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)" class="externalLink">Google Group (Ask Questions)</a>
						</li>
						<li >
							<a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)" class="externalLink">Issue Tracker (Report Bugs/Request Features)</a>
						</li>
						<li >
							<a href="hapi-fhir-faq.html" title="Frequently Asked Questions (FAQ)">Frequently Asked Questions (FAQ)</a>
						</li>
						<li >
							<a href="https://chat.fhir.org/" title="FHIR.org Chat (Live Chat with FHIR Implementors)" class="externalLink">FHIR.org Chat (Live Chat with FHIR Implementors)</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>HAPI FHIR is a Java implementation of the HL7 FHIR
				(Fast Healthcare Interoperable Resources) specification.
				This project is open source (licensed under the Apache Software
				License 2.0) and 100% free to use.<br/><br/>
				<a href="https://github.com/jamesagnew/hapi-fhir"><img src="./images/github-logo-mini.png" alt="Hosted on GitHub" border="0"/></a>
				<br/>
				Star us and we will love you!<br />
				<iframe src="https://ghbtns.com/github-btn.html?user=jamesagnew&repo=hapi-fhir&type=star&count=true" frameborder="0" scrolling="0" width="100px" height="20px"></iframe></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014-2017 <a href="http://www.uhn.ca">University Health Network</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>

	<script src="./js/reflow-skin.js"></script>

	<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>