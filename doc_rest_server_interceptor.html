




 

 
 
 

     <!doctype html>
<!--
 Generated by Apache Maven Doxia  at 2018-12-29  Rendered using Reflow Maven Skin 2.0.0-beta2 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
                                                                    
                    <head>
    <meta charset="UTF-8" />
    <title>Server Interceptors - HAPI FHIR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="James Agnew" />
      <meta http-equiv="content-language" content="en" />
                                                        <link href="https://netdna.bootstrapcdn.com/bootswatch/4.1.3/lumen/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link href="./css/docs.css" rel="stylesheet" />
    <link href="./css/reflow-skin.css" rel="stylesheet" />

    <link href="./css/lightbox.css" rel="stylesheet" />
    <link href="./css/site.css" rel="stylesheet" />
    <link href="./css/print.css" rel="stylesheet" media="print" />
<!-- Syntax Highlighter -->
			<script type="text/javascript" src="syntaxhighlighter/shCore.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushJScript.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushJava.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushBash.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushXml.js"></script>
			
			<link href="syntaxhighlighter/shCore.css" rel="stylesheet" type="text/css" />
			<link href="syntaxhighlighter/shThemeDefault.css" rel="stylesheet" type="text/css" />
			
			<!-- 
			   HAPI stylesheet comes after because it overwrites the Syntax Highlighter
			   font size
			 -->
			<link rel="shortcut icon" href="http://hapifhir.io/favicon.png" />
			<link rel="stylesheet" type="text/css" href="hapi.css" />
        </head> <!-- end : head -->
<body class="page-doc_rest_server_interceptor project-hapi-fhir   scroll-top-smooth-enabled m-toc-sidebar-enabled m-toc-sidebar-expanded m-toc-sidebar-autoexpandable toc-sidebar-fixed">
    <nav id="m-top-navbar" class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary border-bottom">
        <div class="container">
                                <a class="navbar-brand mb-0 h1" href="http://hapifhir.io"><span class="color-highlight">HAPI</span> FHIR</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#top-navbar-collapse-1" aria-controls="top-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                <ul class="nav navbar-nav ml-auto">
<li class="nav-item " ><a     
     href="https://smilecdr.com"  title="Support"   class="externalLink nav-link" >Support</a></li>
<li class="nav-item " ><a     
     href="download.html"  title="Download"  class="nav-link" >Download</a></li>
<li class="nav-item " ><a     
     href="https://github.com/jamesagnew/hapi-fhir"  title="GitHub Project"   class="externalLink nav-link" >GitHub Project</a></li>
                            <li class="nav-item dropdown active">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="docindex.html" title="Documentation Index"  class="dropdown-item ">Documentation Index</a>
                    <a href="doc_intro.html" title="Introduction"  class="dropdown-item ">Introduction</a>
                    <a href="doc_dstu2.html" title="DSTU3 Support / HL7.org Structures"  class="dropdown-item ">DSTU3 Support / HL7.org Structures</a>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_fhirobjects.html"  title="The Data Model"  class="dropdown-item" >The Data Model</a>                        <div class="dropdown-menu">
                                <a href="doc_fhirobjects.html" title="Working with Resources"  class="dropdown-item ">Working with Resources</a>
                                <a href="doc_resource_references.html" title="Resource References"  class="dropdown-item ">Resource References</a>
                                <a href="doc_extensions.html" title="Profiles & Extensions"  class="dropdown-item ">Profiles & Extensions</a>
                                <a href="doc_tags.html" title="Tags"  class="dropdown-item ">Tags</a>
                                <a href="doc_validation.html" title="Validation"  class="dropdown-item ">Validation</a>
                                <a href="doc_custom_structures.html" title="Custom Structures"  class="dropdown-item ">Custom Structures</a>
                                <a href="doc_converter.html" title="Version Converter"  class="dropdown-item ">Version Converter</a>
                            </div>
                    </div>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_rest_client.html"  title="RESTful Client"  class="dropdown-item" >RESTful Client</a>                        <div class="dropdown-menu">
                                <a href="doc_rest_client.html" title="Fluent/Generic Client"  class="dropdown-item ">Fluent/Generic Client</a>
                                <a href="doc_rest_client_annotation.html" title="Annotation Client"  class="dropdown-item ">Annotation Client</a>
                                <a href="doc_rest_client_interceptor.html" title="Interceptors (client)"  class="dropdown-item ">Interceptors (client)</a>
                                <a href="doc_rest_client_http_config.html" title="Client Configuration"  class="dropdown-item ">Client Configuration</a>
                                <a href="doc_rest_client_examples.html" title="Client Examples"  class="dropdown-item ">Client Examples</a>
                                <a href="doc_rest_client_alternate_provider.html" title="JAX-RS Client & Alternate HTTP Providers"  class="dropdown-item ">JAX-RS Client & Alternate HTTP Providers</a>
                            </div>
                    </div>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_rest_server.html"  title="RESTful Server"  class="dropdown-item" >RESTful Server</a>                        <div class="dropdown-menu">
                                <a href="doc_rest_server.html" title="Using RESTful Server"  class="dropdown-item ">Using RESTful Server</a>
                                <a href="doc_rest_operations.html" title="RESTful Operations"  class="dropdown-item ">RESTful Operations</a>
                                <a href="doc_narrative.html" title="Narrative Generator"  class="dropdown-item ">Narrative Generator</a>
                                                <a href="" title="Interceptors (server)"  class="dropdown-item active">Interceptors (server)</a>
                                <a href="doc_rest_server_security.html" title="Security"  class="dropdown-item ">Security</a>
                                <a href="doc_cors.html" title="CORS Support"  class="dropdown-item ">CORS Support</a>
                                <a href="doc_server_tester.html" title="Web Testing UI"  class="dropdown-item ">Web Testing UI</a>
                                <a href="doc_rest_server_jaxrs.html" title="JAX-RS Support"  class="dropdown-item ">JAX-RS Support</a>
                            </div>
                    </div>
                    <a href="doc_logging.html" title="Logging"  class="dropdown-item ">Logging</a>
                    <a href="doc_rest_etag.html" title="ETags"  class="dropdown-item ">ETags</a>
                    <a href="doc_jpa.html" title="JPA/Database Server"  class="dropdown-item ">JPA/Database Server</a>
                    <a href="doc_android.html" title="Android Support"  class="dropdown-item ">Android Support</a>
                    <div class="dropdown-submenu ">
    <a     
     href="apidocs/index.html"  title="JavaDocs"  class="dropdown-item" >JavaDocs</a>                        <div class="dropdown-menu">
                                <a href="apidocs/index.html" title="Core API"  class="dropdown-item ">Core API</a>
                                <a href="apidocs-dstu2/index.html" title="Model API (DSTU2)"  class="dropdown-item ">Model API (DSTU2)</a>
                                <a href="apidocs-dstu3/index.html" title="Model API (DSTU3)"  class="dropdown-item ">Model API (DSTU3)</a>
                                <a href="apidocs-r4/index.html" title="Model API (R4)"  class="dropdown-item ">Model API (R4)</a>
                                <a href="apidocs-client/index.html" title="Client API"  class="dropdown-item ">Client API</a>
                                <a href="apidocs-server/index.html" title="Server API (Plain)"  class="dropdown-item ">Server API (Plain)</a>
                                <a href="apidocs-jpaserver/index.html" title="Server API (JPA)"  class="dropdown-item ">Server API (JPA)</a>
                            </div>
                    </div>
                    <a href="doc_cli.html" title="Command Line Tool (hapi-fhir-cli)"  class="dropdown-item ">Command Line Tool (hapi-fhir-cli)</a>
                    <a href="doc_tinder.html" title="Maven Plugin (hapi-tinder-plugin)"  class="dropdown-item ">Maven Plugin (hapi-tinder-plugin)</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Get Help <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="https://github.com/jamesagnew/hapi-fhir/wiki/Getting-Help" title="How to Ask for Help (read this first!)"  class="dropdown-item ">How to Ask for Help (read this first!)</a>
                    <a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)"  class="dropdown-item ">Google Group (Ask Questions)</a>
                    <a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)"  class="dropdown-item ">Issue Tracker (Report Bugs/Request Features)</a>
                    <a href="https://chat.fhir.org" title="FHIR.org Chat (Live Chat with FHIR Implementors)"  class="dropdown-item ">FHIR.org Chat (Live Chat with FHIR Implementors)</a>
                    <a href="hapi-fhir-faq.html" title="Frequently Asked Questions (FAQ)"  class="dropdown-item ">Frequently Asked Questions (FAQ)</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Test Server <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="http://hapi.fhir.org" title="Public Test Server"  class="dropdown-item ">Public Test Server</a>
                </div>
            </li>
                </ul><!--/ul.navbar-nav -->
            </div><!--/.nav-collapse -->
        </div> <!--/.container -->
    </nav> <!--/.navbar -->
    <div class="main-body container-fuild my-3">
    <div class="row m-0">
        <div class="d-xs-none d-sm-none d-md-none d-lg-block col-lg-2">
        </div>
        <main class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-8" role="main">
            <div class="header container-fluid">
                                     <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a     
     href="index.html"  title="HAPI FHIR"  class="" >HAPI FHIR</a></li>
            <li class="breadcrumb-item active">Server Interceptors</li>

        </ol>
    </nav>
            </div> <!-- end : header -->
                             <div class="section"> 
 <div class="page-header">
  <h2 id="_toc_server_interceptors">Server Interceptors</h2>
 </div> 
 <p> The RESTful server provides a powerful mechanism for adding cross-cutting behaviour (e.g. requests, such as authnorization, auditing, fancy output, logging, etc.) to each incoming request that it processes. This mechanism consists of defining one or more <b>interceptors</b> that will be invoked at defined points in the processing of each incoming request. </p> 
 <img src="svg/restful-server-interceptors.svg" alt="Interceptors" class="img-fluid"> 
 <p> Interceptors will intercept the incoming request, and can take action such as logging or auditing it, or examining/injecting headers. They can optionally choose to handle the request directly and the cancel any subsequent processing (in other words, the interceptor can choose to supply a response to the client, and can then signal to the server that it does not need to do so). </p> 
 <p> Interceptors may also be notified of responses prior to those responses being served to a client, and may audit or even cancel the response. The diagram on the right shows the lifecycle of a normal (non failing) request which is subject to an interceptor. </p> 
 <p> Interceptors must implement the <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/IServerInterceptor.html">IServerInterceptor</a> interface (or extend the convenience <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/InterceptorAdapter.html">InterceptorAdapter</a> class provided). The RESTful server will normally invoke the interceptor at several points in the execution of the client request. </p> 
 <ul> 
  <li> Before any processing at all is performed on the request, <b>incomingRequestPreProcessed</b> will be invoked. This can be useful if you wish to handle some requests completely outside of HAPI's processing mechanism. 
   <ul> 
    <li> If this method returns <code class="\&quot;literal\&quot;">true</code>, processing continues to the next interceptor, and ultimately to the next phase of processing. </li> 
    <li> If this method returns <code class="\&quot;literal\&quot;">false</code>, processing stops immediately. This is useful if the interceptor wishes to supply its own response by directly calling methods on the <code class="\&quot;literal\&quot;">HttpServletResponse</code> </li> 
    <li> If this method throws any subclass of <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a>, processing is stopped immedicately and the corresponding status is returned to the client. This is useful if an interceptor wishes to abort the request (e.g. because it did not detect valid credentials) </li> 
   </ul> </li> 
  <li> Once the request is classified (meaning that the URL and request headers are examined to determine exactly what kind of request is being made), <b>incomingRequestPostProcessed</b> will be invoked. This method has an additional parameter, the <a href="./apidocs/ca/uhn/fhir/rest/method/RequestDetails.html">RequestDetails</a> object which contains details about what operation is about to be called, and what request parameters were receievd with that request. 
   <ul> 
    <li> If this method returns <code class="\&quot;literal\&quot;">true</code>, processing continues to the next interceptor, and ultimately to the next phase of processing. </li> 
    <li> If this method returns <code class="\&quot;literal\&quot;">false</code>, processing stops immediately. This is useful if the interceptor wishes to supply its own response by directly calling methods on the <code class="\&quot;literal\&quot;">HttpServletResponse</code> </li> 
    <li> If this method throws any subclass of <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a>, processing is stopped immedicately and the corresponding status is returned to the client. This is useful if an interceptor wishes to abort the request (e.g. because it did not detect valid credentials) </li> 
   </ul> </li> 
  <li> Once the request is being handled, <b>incomingRequestPreHandled</b> will be invoked. This method is useful in that it provides details about the FHIR operation being invoked (e.g. is this a "read" or a "create"? what is the resource type and ID of the resource being accessed, etc.). This method can be useful for adding finer grained access controls. Note that <code class="\&quot;literal\&quot;">incomingRequestPreHandled</code> is not able to directly supply a response, but it may throw a <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a> to abort processing. </li> 
  <li> After the operation is handled (by invoking the corresponding ResourceProvider or PlainProvider method), but before the actual response is returned to the client, the <b>outgoingResponse</b> method is invoked. This method also has details about the request in its parameters, but also receives a copy of the response that is about to be returned. Note that there are three implementations of <b>outgoingResponse</b>: The server will invoke the one which corresponds to the response type of the operation being invoked (resource, bundle, etc.) </li> 
 </ul> 
 <br> 
 <div class="section"> 
  <h3 id="_toc_exception_handling">Exception Handling</h3> 
  <img src="svg/restful-server-interceptors-exception.svg" alt="Interceptors" align="right" class="img-fluid"> 
  <p> In the event of an exception being thrown within the server, the interceptor method <code class="\&quot;literal\&quot;"><a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/IServerInterceptor.html#handleExceptionca.uhn.fhir.rest.method.RequestDetails20java.lang.Throwable20javax.servlet.http.HttpServletRequest20javax.servlet.http.HttpServletResponse">handleException</a></code> will be called. This applies both to HAPI-FHIR defined exceptions thrown within resource provider methods you have created as well as unexpected exceptions such as NullPointerException thrown at any point in the handling chain. </p> 
  <p> In general, you will want to return <code class="\&quot;literal\&quot;">true</code> from the <code class="\&quot;literal\&quot;">handleException</code> method, which means that processing continues normally (RestfulServer will return an HTTP 4xx or 5xx response automatically depending on the specific exception which was thrown). </p> 
  <p> However, you may override the server's built-in exception handling by returning <code class="\&quot;literal\&quot;">false</code>. In this case, you must provide your own response by interacting with the <code class="\&quot;literal\&quot;">HttpServletResponse</code> object which is passed in. </p> 
 </div> 
 <br> 
 <div class="section"> 
  <h3 id="_toc_registering_interceptors">Registering Interceptors</h3> 
  <p> To register an interceptor to the server, simply call either <code class="\&quot;literal\&quot;">registerInterceptor</code> or <code class="\&quot;literal\&quot;">setInterceptors</code> on your RestfulServer instance. </p> 
  <p> Note that order is important: The server will invoke <code class="\&quot;literal\&quot;">incomingRequestPreProcessed</code> and <code class="\&quot;literal\&quot;">incomingRequestPostProcessed</code> in the same order that they are registered to the server. The server will invoke <code class="\&quot;literal\&quot;">outgoingResponse</code> in the <b>reverse</b> order to the order in which the interceptors were registered. This means that interceptors can be thought of as "wrapping" the request. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_built_in_interceptors">Built In Interceptors</h2> 
 <p> HAPI also provides built-in interceptors which may be useful. Links to the code for each interceptor is also provided, to give examples of how interceptors are written. </p> 
 <a name="Logging"></a> 
 <div class="section"> 
  <h3 id="_toc_logging_server_requests">Logging Server Requests</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/LoggingInterceptor.html">LoggingInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/LoggingInterceptor.html">code</a>) can be used to generate a new log line (via SLF4j) for each incoming request. LoggingInterceptor provides a flexible message format that can be used to provide a customized level of detail about each incoming request. </p> 
  <p> The following example shows how to register a logging interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { "/fhir/*" }, displayName = "FHIR Server")
   public class RestfulServerWithLogging extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...
         
         // Now register the logging interceptor
         LoggingInterceptor loggingInterceptor = new LoggingInterceptor();
         registerInterceptor(loggingInterceptor);

         // The SLF4j logger "test.accesslog" will receive the logging events 
         loggingInterceptor.setLoggerName("test.accesslog");
         
         // This is the format for each line. A number of substitution variables may
         // be used here. See the JavaDoc for LoggingInterceptor for information on
         // what is available.
         loggingInterceptor.setMessageFormat("Source[${remoteAddr}] Operation[${operationType} ${idOrResourceName}] UA[${requestHeader.user-agent}] Params[${requestParameters}]");
         
      }
      
   }
</pre> 
  </div> 
  <p> This interceptor will then produce output similar to the following: </p> 
  <div class="source"> 
   <pre>2014-09-04 02:37:30.030 Source[127.0.0.1] Operation[vread Patient/1667/_history/1] UA[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.94 Safari/537.36] Params[?_format=json]
2014-09-04 03:30:00.443 Source[127.0.0.1] Operation[search-type Organization] UA[Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)] Params[]</pre> 
  </div> 
 </div> 
 <a name="ExceptionHandlingInterceptor"></a> 
 <div class="section"> 
  <h3 id="_toc_exception_handling1">Exception Handling</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/ExceptionHandlingInterceptor.html">ExceptionHandlingInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/ExceptionHandlingInterceptor.html">code</a>) can be used to customize what is returned to the client and what is logged when the server throws an exception for any reason (including routine things like UnprocessableEntityExceptions thrown as a matter of normal processing in a create method, but also including unexpected NullPointerExceptions thrown by client code). </p> 
  <p> The following example shows how to register an exception handling interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { "/fhir/*" }, displayName = "FHIR Server")
   public class RestfulServerWithExceptionHandling extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...
         
         // Now register the interceptor
         ExceptionHandlingInterceptor interceptor = new ExceptionHandlingInterceptor();
         registerInterceptor(interceptor);

         // Return the stack trace to the client for the following exception types
         interceptor.setReturnStackTracesForExceptionTypes(InternalErrorException.class, NullPointerException.class);
         
      }
      
   }
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_response_syntax_highlighting">Response Syntax Highlighting</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/ResponseHighlighterInterceptor.html">ResponseHighlighterInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/ResponseHighlighterInterceptor.html">code</a>) detects when a request is coming from a browser and returns HTML with syntax highlighted XML/JSON instead of just the raw text. In other words, if a user uses a browser to request "http://foo/Patient/1" by typing this address into their URL bar, they will get nice formatted HTML back with a human readable version of the content. This is helpful for testers. </p> 
  <p> To see an example of how this looks, see our demo server using the following example query: <a class="externalLink" href="http://fhirtest.uhn.ca/baseDstu2/Patient/">http://fhirtest.uhn.ca/baseDstu2/Patient</a> </p> 
  <p> The following example shows how to register this interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { "/fhir/*" }, displayName = "FHIR Server")
   public class RestfulServerWithResponseHighlighter extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...
         
         // Now register the interceptor
         ResponseHighlighterInterceptor interceptor = new ResponseHighlighterInterceptor();
         registerInterceptor(interceptor);

      }
      
   }
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_requestresponse_validation">Request/Response Validation</h3> 
  <p> The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/RequestValidatingInterceptor.html">RequestValidatingInterceptor</a> and <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/ResponseValidatingInterceptor.html">ResponseValidatingInterceptor</a> can be used to perform validation of resources on their way into and out of the server respectively. </p> 
  <p> The RequestValidatingInterceptor looks at resources coming into the server (e.g. for create, update, $operations, transactions, etc.) and validates them. The ResponseValidatingInterceptor looks at resources being returned by the server (e.g. for read, search, $operations, etc.) and validates them. </p> 
  <p> These interceptors can be configured to add headers to the response, fail the response (returning an HTTP 422 and throwing an exception in the process), or to add to the OperationOutcome returned by the server. </p> 
  <p> See the <a href="./doc_validation.html">Validation Page</a> for information on available <a href="./apidocs/ca/uhn/fhir/validation/IValidatorModule.html">IValidatorModule</a> validation modules. Any of the <b>Resource Validators</b> listed on that page can be enabled in these interceptors (note that the <b>Parser Validators</b> can not). </p> 
  <p> The following example shows how to register this interceptor within a FHIR RESTful server. </p> 
  <div class="source"> 
   <pre>   @WebServlet(urlPatterns = { "/fhir/*" }, displayName = "FHIR Server")
   public class ValidatingServerWithLogging extends RestfulServer {

      @Override
      protected void initialize() throws ServletException {
         
         // ... define your resource providers here ...

         // Create an interceptor to validate incoming requests
         RequestValidatingInterceptor requestInterceptor = new RequestValidatingInterceptor();
         
         // Register a validator module (you could also use SchemaBaseValidator and/or SchematronBaseValidator)
         requestInterceptor.addValidatorModule(new FhirInstanceValidator());
         
         requestInterceptor.setFailOnSeverity(ResultSeverityEnum.ERROR);
         requestInterceptor.setAddResponseHeaderOnSeverity(ResultSeverityEnum.INFORMATION);
         requestInterceptor.setResponseHeaderValue("Validation on ${line}: ${message} ${severity}");
         requestInterceptor.setResponseHeaderValueNoIssues("No issues detected");
         
         // Now register the validating interceptor
         registerInterceptor(requestInterceptor);

         // Create an interceptor to validate responses
         // This is configured in the same way as above
         ResponseValidatingInterceptor responseInterceptor = new ResponseValidatingInterceptor();
         responseInterceptor.addValidatorModule(new FhirInstanceValidator());
         responseInterceptor.setFailOnSeverity(ResultSeverityEnum.ERROR);
         responseInterceptor.setAddResponseHeaderOnSeverity(ResultSeverityEnum.INFORMATION);
         responseInterceptor.setResponseHeaderValue("Validation on ${line}: ${message} ${severity}");
         responseInterceptor.setResponseHeaderValueNoIssues("No issues detected");
         registerInterceptor(responseInterceptor);
      }
      
   }
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_cors_cross-origin_resource_sharing">CORS (Cross-Origin Resource Sharing)</h3> 
  <p> HAPI FHIR includes an interceptor which can be used to implement CORS support on your server. See HAPI's <a href="./doc_cors.html">CORS Documentation</a> for information on how to use this interceptor. </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_rejecting_unsupported_http_verbs">Rejecting Unsupported HTTP Verbs</h3> 
  <p> Some security audit tools require that servers return an HTTP 405 if an unsupported HTTP verb is received (e.g. TRACE). The <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/BanUnsupprtedHttpMethodsInterceptor.html">BanUnsupprtedHttpMethodsInterceptor</a> (<a href="./xref/ca/uhn/fhir/rest/server/interceptor/BanUnsupprtedHttpMethodsInterceptor.html">code</a>) can be used to accomplish this. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_creating_interceptors">Creating Interceptors</h2> 
 <p> Creating your own interceptors is easy. HAPI-FHIR provides a class called <code class="\&quot;literal\&quot;">InterceptorAdapter</code> which you can extend and then override any methods you wish. The following example shows a simple request counter. </p> 
 <div class="source"> 
  <pre>public class RequestCounterInterceptor extends InterceptorAdapter
{

   private int myRequestCount;

   public int getRequestCount() {
      return myRequestCount;
   }

   /**
    * Override the incomingRequestPreProcessed method, which is called
    * for each incoming request before any processing is done
    */
   @Override
   public boolean incomingRequestPreProcessed(HttpServletRequest theRequest, HttpServletResponse theResponse) {
      myRequestCount++;
      return true;
   }
   
}
</pre> 
 </div> 
 <p> The following example shows an exception handling interceptor which overrides the built-in exception handling by providing a custom response. </p> 
 <div class="source"> 
  <pre>public class RequestExceptionInterceptor extends InterceptorAdapter
{

   @Override
   public boolean handleException(RequestDetails theRequestDetails, BaseServerResponseException theException, HttpServletRequest theServletRequest,
         HttpServletResponse theServletResponse) throws ServletException, IOException {
      
      // HAPI's server exceptions know what the appropriate HTTP status code is
      theServletResponse.setStatus(theException.getStatusCode());
      
      // Provide a response ourself
      theServletResponse.setContentType("text/plain");
      theServletResponse.getWriter().append("Failed to process!");
      theServletResponse.getWriter().close();
      
      // Since we handled this response in the interceptor, we must return false
      // to stop processing immediately
      return false;
   }


}
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_jpa_server_interceptors">JPA Server Interceptors</h2> 
 <p> The HAPI <a href="./doc_jpa.html">JPA Server</a> is an added layer on top of the HAPI REST server framework. When you </p> 
 <p> When an interceptor is registered against a RestfulServer which is backed by the HAPI JPA Server, the <code class="\&quot;literal\&quot;">incomingRequestPreHandled</code> method will be called once for most operations (e.g. a FHIR <code class="\&quot;literal\&quot;">create</code>), but in the case where the client performs a FHIR <code class="\&quot;literal\&quot;">transaction</code> that method might be called multiple times over the course of a single client invocation. For example if the transaction contained a single create, the <code class="\&quot;literal\&quot;">incomingRequestPreHandled</code> method will be called twice: once to indicate the transaction, and once to indicate the create. </p> 
 <p> This behaviour can be useful in cases where you want to audit exactly what was done over the course of a request. Since a transaction can contain creates, updates, and even more nested transactions, this behaviour ensures that you are notified for each activity. </p> 
 <p> You may also choose to create interceptors which implement the more specialized <a href="./apidocs/ca/uhn/fhir/rest/server/interceptor/IServerOperationInterceptor.html">IJpaServerInterceptor</a> interface, as this interceptor adds additional methods which are called during the JPA lifecycle. </p> 
 <p> Note that this documentation used to <b>erroneously</b> suggest that in order to achieve this behaviour you needed to register the interceptor with the DaoConfig. In actual fact this did not make any difference, and registering interceptors with the DaoConfig has now been deprecated since it does not achieve anything extra. </p> 
</div>                    </main>
        <div class="d-none d-sm-none d-md-none d-lg-none d-xl-block col-xl-2">
                        <div id="m-toc-sidebar" class="d-print-none m-toc-sidebar-enabled m-toc-sidebar-expanded m-toc-sidebar-autoexpandable toc-sidebar-fixed">
                <nav id="m-toc-sidebar-nav flex-column">
                <ul class="m-nav--sidebar nav flex-column flex-nowrap">
    <li class="h2">
        <a class="nav-link" href="#_toc_server_interceptors" title="Server Interceptors">Server Interceptors</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_exception_handling" title="Exception Handling">Exception Handling</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_registering_interceptors" title="Registering Interceptors">Registering Interceptors</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_built_in_interceptors" title="Built In Interceptors">Built In Interceptors</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_logging_server_requests" title="Logging Server Requests">Logging Server Requests</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_exception_handling1" title="Exception Handling">Exception Handling</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_response_syntax_highlighting" title="Response Syntax Highlighting">Response Syntax Highlighting</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_requestresponse_validation" title="Request/Response Validation">Request/Response Validation</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_cors_cross-origin_resource_sharing" title="CORS (Cross-Origin Resource Sharing)">CORS (Cross-Origin Resource Sharing)</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_rejecting_unsupported_http_verbs" title="Rejecting Unsupported HTTP Verbs">Rejecting Unsupported HTTP Verbs</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_creating_interceptors" title="Creating Interceptors">Creating Interceptors</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_jpa_server_interceptors" title="JPA Server Interceptors">JPA Server Interceptors</a>
    </li>
                    </ul>
                </nav>
           </div>
            </div>
    </div> <!-- row: end -->
</div> <!-- .main-body: end -->
    <div id="m-scroll-top" style="display: none;">
        <a href="javascript:;">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
  <!-- Footer -->
  <footer class="footer-light bg-light">
    <div class="container">
        <div class="row">
        
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">HAPI FHIR                    </li>
                    <li class="nav-item " )><a     
     href="index.html"  title="Home"  class="nav-link" >Home</a></li>
                    <li class="nav-item " )><a     
     href="download.html"  title="Download"  class="nav-link" >Download</a></li>
                    <li class="nav-item " )><a     
     href="changes-report.html"  title="Changelog"  class="nav-link" >Changelog</a></li>
                    <li class="nav-item " )><a     
     href="license.html"  title="License"  class="nav-link" >License</a></li>
                    <li class="nav-header">Test Server                    </li>
                    <li class="nav-item " )><a     
     href="http://hapi.fhir.org"  title="Public Test Server"   class="externalLink nav-link" >Public Test Server</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">Using HAPI                    </li>
                    <li class="nav-item " )><a     
     href="docindex.html"  title="Documentation Index"  class="nav-link" >Documentation Index</a></li>
                    <li class="nav-item " )><a     
     href="doc_cli.html"  title="Command Line Tool (cli)"  class="nav-link" >Command Line Tool (cli)</a></li>
                    <li class="nav-header">Contribute                    </li>
                    <li class="nav-item " )><a     
     href="hacking_hapi_fhir.html"  title="Guide to Hacking HAPI"  class="nav-link" >Guide to Hacking HAPI</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">JavaDocs                    </li>
                    <li class="nav-item " )><a     
     href="apidocs/index.html"  title="Core API"  class="nav-link" >Core API</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu/index.html"  title="Model API (DSTU1)"  class="nav-link" >Model API (DSTU1)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu2/index.html"  title="Model API (DSTU2)"  class="nav-link" >Model API (DSTU2)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu3/index.html"  title="Model API (DSTU3)"  class="nav-link" >Model API (DSTU3)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-r4/index.html"  title="Model API (R4)"  class="nav-link" >Model API (R4)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-client/index.html"  title="Client API"  class="nav-link" >Client API</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-server/index.html"  title="Server API (Plain)"  class="nav-link" >Server API (Plain)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-jpaserver/index.html"  title="Server API (JPA)"  class="nav-link" >Server API (JPA)</a></li>
                    <li class="nav-header">JXR                    </li>
                    <li class="nav-item " )><a     
     href="xref-base/index.html"  title="Core"  class="nav-link" >Core</a></li>
                    <li class="nav-item " )><a     
     href="xref-jpaserver/index.html"  title="JPA Server"  class="nav-link" >JPA Server</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">Get Help                    </li>
                    <li class="nav-item " )><a     
     href="https://github.com/jamesagnew/hapi-fhir/wiki/Getting-Help"  title="How to Ask for Help (read this first!)"   class="externalLink nav-link" >How to Ask for Help (read this first!)</a></li>
                    <li class="nav-item " )><a     
     href="https://groups.google.com/d/forum/hapi-fhir"  title="Google Group (Ask Questions)"   class="externalLink nav-link" >Google Group (Ask Questions)</a></li>
                    <li class="nav-item " )><a     
     href="https://github.com/jamesagnew/hapi-fhir/issues"  title="Issue Tracker (Report Bugs/Request Features)"   class="externalLink nav-link" >Issue Tracker (Report Bugs/Request Features)</a></li>
                    <li class="nav-item " )><a     
     href="https://chat.fhir.org"  title="FHIR.org Chat (Live Chat with FHIR Implementors)"   class="externalLink nav-link" >FHIR.org Chat (Live Chat with FHIR Implementors)</a></li>
                    <li class="nav-item " )><a     
     href="hapi-fhir-faq.html"  title="Frequently Asked Questions (FAQ)"  class="nav-link" >Frequently Asked Questions (FAQ)</a></li>
                </ul>
            </div>
        <div class="col bottom-description">
            <blockquote class="blockquote">HAPI FHIR is a Java implementation of the HL7 FHIR
				(Fast Healthcare Interoperable Resources) specification.
				This project is open source (licensed under the Apache Software
				License 2.0) and 100% free to use.<br/><br/>
				<a href="https://github.com/jamesagnew/hapi-fhir"><img src="./images/github-logo-mini.png" alt="Hosted on GitHub" border="0"/></a>
				<br/>
				Star us and we will love you!<br />
				<iframe src="https://ghbtns.com/github-btn.html?user=jamesagnew&repo=hapi-fhir&type=star&count=true" frameborder="0" scrolling="0" width="100px" height="20px"></iframe></blockquote>
        </div>
      </div>
    </div>
  </footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="copyright">Copyright &copy;2014-2018                 <a href="http://www.uhn.ca">University Health Network</a>
. All Rights Reserved.</p>
        <p class="version-date">
<span class="projectVersion">Version: 3.7.0-SNAPSHOT. </span><span class="publishDate">
    Last Published: 2018-12-29
. </span>        </p>
        <p><a href="https://github.com/devacfr/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://devacfr.github.io" target="_blank" title="devacfr">devacfr</a>.</p>
      </div>
    </div>
  </div>

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/${popperVersion}/umd//popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

  <script src="./js/lightbox.min.js"></script>
      <script src="./js/reflow-skin.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
    <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>