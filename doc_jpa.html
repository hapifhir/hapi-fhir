




 

 
 
 

     <!doctype html>
<!--
 Generated by Apache Maven Doxia  at 2019-03-01  Rendered using Reflow Maven Skin 2.0.0-beta2 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
                                                                    
                    <head>
    <meta charset="UTF-8" />
    <title>JPA Server - HAPI FHIR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="James Agnew" />
      <meta http-equiv="content-language" content="en" />
                                                        <link href="https://netdna.bootstrapcdn.com/bootswatch/4.1.3/lumen/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link href="./css/docs.css" rel="stylesheet" />
    <link href="./css/reflow-skin.css" rel="stylesheet" />

    <link href="./css/lightbox.css" rel="stylesheet" />
    <link href="./css/site.css" rel="stylesheet" />
    <link href="./css/print.css" rel="stylesheet" media="print" />
<!-- Syntax Highlighter -->
			<script type="text/javascript" src="syntaxhighlighter/shCore.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushJScript.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushJava.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushBash.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushXml.js"></script>
			
			<link href="syntaxhighlighter/shCore.css" rel="stylesheet" type="text/css" />
			<link href="syntaxhighlighter/shThemeDefault.css" rel="stylesheet" type="text/css" />
			
			<!-- 
			   HAPI stylesheet comes after because it overwrites the Syntax Highlighter
			   font size
			 -->
			<link rel="shortcut icon" href="http://hapifhir.io/favicon.png" />
			<link rel="stylesheet" type="text/css" href="hapi.css" />
        </head> <!-- end : head -->
<body class="page-doc_jpa project-hapi-fhir   scroll-top-smooth-enabled m-toc-sidebar-enabled m-toc-sidebar-expanded m-toc-sidebar-autoexpandable toc-sidebar-fixed">
    <nav id="m-top-navbar" class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary border-bottom">
        <div class="container">
                                <a class="navbar-brand mb-0 h1" href="http://hapifhir.io"><span class="color-highlight">HAPI</span> FHIR</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#top-navbar-collapse-1" aria-controls="top-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                <ul class="nav navbar-nav ml-auto">
<li class="nav-item " ><a     
     href="https://smilecdr.com"  title="Support"   class="externalLink nav-link" >Support</a></li>
<li class="nav-item " ><a     
     href="download.html"  title="Download"  class="nav-link" >Download</a></li>
<li class="nav-item " ><a     
     href="https://github.com/jamesagnew/hapi-fhir"  title="GitHub Project"   class="externalLink nav-link" >GitHub Project</a></li>
                            <li class="nav-item dropdown active">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="docindex.html" title="Documentation Index"  class="dropdown-item ">Documentation Index</a>
                    <a href="doc_intro.html" title="Introduction"  class="dropdown-item ">Introduction</a>
                    <a href="doc_dstu2.html" title="DSTU3 Support / HL7.org Structures"  class="dropdown-item ">DSTU3 Support / HL7.org Structures</a>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_fhirobjects.html"  title="The Data Model"  class="dropdown-item" >The Data Model</a>                        <div class="dropdown-menu">
                                <a href="doc_fhirobjects.html" title="Working with Resources"  class="dropdown-item ">Working with Resources</a>
                                <a href="doc_resource_references.html" title="Resource References"  class="dropdown-item ">Resource References</a>
                                <a href="doc_extensions.html" title="Profiles & Extensions"  class="dropdown-item ">Profiles & Extensions</a>
                                <a href="doc_tags.html" title="Tags"  class="dropdown-item ">Tags</a>
                                <a href="doc_validation.html" title="Validation"  class="dropdown-item ">Validation</a>
                                <a href="doc_custom_structures.html" title="Custom Structures"  class="dropdown-item ">Custom Structures</a>
                                <a href="doc_converter.html" title="Version Converter"  class="dropdown-item ">Version Converter</a>
                            </div>
                    </div>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_rest_client.html"  title="RESTful Client"  class="dropdown-item" >RESTful Client</a>                        <div class="dropdown-menu">
                                <a href="doc_rest_client.html" title="Fluent/Generic Client"  class="dropdown-item ">Fluent/Generic Client</a>
                                <a href="doc_rest_client_annotation.html" title="Annotation Client"  class="dropdown-item ">Annotation Client</a>
                                <a href="doc_rest_client_interceptor.html" title="Interceptors (client)"  class="dropdown-item ">Interceptors (client)</a>
                                <a href="doc_rest_client_http_config.html" title="Client Configuration"  class="dropdown-item ">Client Configuration</a>
                                <a href="doc_rest_client_examples.html" title="Client Examples"  class="dropdown-item ">Client Examples</a>
                                <a href="doc_rest_client_alternate_provider.html" title="JAX-RS Client & Alternate HTTP Providers"  class="dropdown-item ">JAX-RS Client & Alternate HTTP Providers</a>
                            </div>
                    </div>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_rest_server.html"  title="RESTful Server"  class="dropdown-item" >RESTful Server</a>                        <div class="dropdown-menu">
                                <a href="doc_rest_server.html" title="Using RESTful Server"  class="dropdown-item ">Using RESTful Server</a>
                                <a href="doc_rest_operations.html" title="RESTful Operations"  class="dropdown-item ">RESTful Operations</a>
                                <a href="doc_narrative.html" title="Narrative Generator"  class="dropdown-item ">Narrative Generator</a>
                                <a href="doc_rest_server_interceptor.html" title="Interceptors (server)"  class="dropdown-item ">Interceptors (server)</a>
                                <a href="doc_rest_server_security.html" title="Security"  class="dropdown-item ">Security</a>
                                <a href="doc_cors.html" title="CORS Support"  class="dropdown-item ">CORS Support</a>
                                <a href="doc_server_tester.html" title="Web Testing UI"  class="dropdown-item ">Web Testing UI</a>
                                <a href="doc_rest_server_jaxrs.html" title="JAX-RS Support"  class="dropdown-item ">JAX-RS Support</a>
                            </div>
                    </div>
                    <a href="doc_logging.html" title="Logging"  class="dropdown-item ">Logging</a>
                    <a href="doc_rest_etag.html" title="ETags"  class="dropdown-item ">ETags</a>
                                    <a href="" title="JPA/Database Server"  class="dropdown-item active">JPA/Database Server</a>
                    <a href="doc_android.html" title="Android Support"  class="dropdown-item ">Android Support</a>
                    <div class="dropdown-submenu ">
    <a     
     href="apidocs/index.html"  title="JavaDocs"  class="dropdown-item" >JavaDocs</a>                        <div class="dropdown-menu">
                                <a href="apidocs/index.html" title="Core API"  class="dropdown-item ">Core API</a>
                                <a href="apidocs-dstu2/index.html" title="Model API (DSTU2)"  class="dropdown-item ">Model API (DSTU2)</a>
                                <a href="apidocs-dstu3/index.html" title="Model API (DSTU3)"  class="dropdown-item ">Model API (DSTU3)</a>
                                <a href="apidocs-r4/index.html" title="Model API (R4)"  class="dropdown-item ">Model API (R4)</a>
                                <a href="apidocs-client/index.html" title="Client API"  class="dropdown-item ">Client API</a>
                                <a href="apidocs-server/index.html" title="Server API (Plain)"  class="dropdown-item ">Server API (Plain)</a>
                                <a href="apidocs-jpaserver/index.html" title="Server API (JPA)"  class="dropdown-item ">Server API (JPA)</a>
                            </div>
                    </div>
                    <a href="doc_cli.html" title="Command Line Tool (hapi-fhir-cli)"  class="dropdown-item ">Command Line Tool (hapi-fhir-cli)</a>
                    <a href="doc_tinder.html" title="Maven Plugin (hapi-tinder-plugin)"  class="dropdown-item ">Maven Plugin (hapi-tinder-plugin)</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Get Help <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="https://github.com/jamesagnew/hapi-fhir/wiki/Getting-Help" title="How to Ask for Help (read this first!)"  class="dropdown-item ">How to Ask for Help (read this first!)</a>
                    <a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)"  class="dropdown-item ">Google Group (Ask Questions)</a>
                    <a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)"  class="dropdown-item ">Issue Tracker (Report Bugs/Request Features)</a>
                    <a href="https://chat.fhir.org" title="FHIR.org Chat (Live Chat with FHIR Implementors)"  class="dropdown-item ">FHIR.org Chat (Live Chat with FHIR Implementors)</a>
                    <a href="hapi-fhir-faq.html" title="Frequently Asked Questions (FAQ)"  class="dropdown-item ">Frequently Asked Questions (FAQ)</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Test Server <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="http://hapi.fhir.org" title="Public Test Server"  class="dropdown-item ">Public Test Server</a>
                </div>
            </li>
                </ul><!--/ul.navbar-nav -->
            </div><!--/.nav-collapse -->
        </div> <!--/.container -->
    </nav> <!--/.navbar -->
    <div class="main-body container-fuild my-3">
    <div class="row m-0">
        <div class="d-xs-none d-sm-none d-md-none d-lg-block col-lg-2">
        </div>
        <main class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-8" role="main">
            <div class="header container-fluid">
                                     <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a     
     href="index.html"  title="HAPI FHIR"  class="" >HAPI FHIR</a></li>
            <li class="breadcrumb-item active">JPA Server</li>

        </ol>
    </nav>
            </div> <!-- end : header -->
                             <div class="section"> 
 <div class="page-header">
  <h2 id="_toc_jpa_server">JPA Server</h2>
 </div> 
 <p> The HAPI FHIR <a href="./doc_rest_server.html">RestfulServer</a> module can be used to create a FHIR server endpoint against an arbitrary data source, which could be a database of your own design, an existing clinical system, a set of files, or anything else you come up with. </p> 
 <p> HAPI also provides a persistence module which can be used to provide a complete RESTful server implementation, backed by a database of your choosing. This module uses the <a class="externalLink" href="http://en.wikipedia.org/wiki/Java_Persistence_API">JPA 2.0</a> API to store data in a database without depending on any specific database technology. </p> 
 <p> <b>Important Note: </b> This implementation uses a fairly simple table design, with a single table being used to hold resource bodies (which are stored as CLOBs, optionally GZipped to save space) and a set of tables to hold search indexes, tags, history details, etc. This design is only one of many possible ways of designing a FHIR server so it is worth considering whether it is appropriate for the problem you are trying to solve. </p> 
 <div class="section"> 
  <h3 id="_toc_getting_started">Getting Started</h3> 
  <p> The easiest way to get started with HAPI's JPA server module is to begin with the example project. There is a complete sample project found in our GitHub repo here: <a class="externalLink" href="https://github.com/jamesagnew/hapi-fhir/tree/master/hapi-fhir-jpaserver-example">hapi-fhir-jpaserver-example</a> </p> 
  <p> This example is a fully contained FHIR server, supporting all standard operations (read/create/delete/etc). It bundles an embedded instance of the <a class="externalLink" href="http://db.apache.org/derby/">Apache Derby</a> Java database so that the server can run without depending on any external database, but it can also be configured to use an installation of Oracle, Postgres, etc. </p> 
  <p> To take this project for a spin, check out the sources from GitHib (or download a snapshot), and then build the project: </p> 
  <div class="source"> 
   <pre>$ cd hapi-fhir-jpaserver-example
$ mvn install</pre> 
  </div> 
  <p> You now have two options for starting the server: </p> 
  <ul> 
   <li> <b>Deploy to Tomcat/JBoss/Websphere/etc: </b> You will now have a file in your <code class="\&quot;literal\&quot;">target</code> directory called <code class="\&quot;literal\&quot;">hapi-fhir-jpaserver-example.war</code>. This WAR file can be deployed to any Servlet container, at which point you could access the server by pointing your browser at a URL similar to the following (you may need to adjust the port depending on which port your container is configured to listen on): <a class="externalLink" href="http://localhost:8080/hapi-fhir-jpaserver-example/">http://localhost:8080/hapi-fhir-jpaserver-example/</a> </li> 
   <li> <b>Run with Maven and Embedded Jetty: </b> To start the server directly within Maven, you can execute the following command:<br> 
    <div class="source"> 
     <pre>$ mvn jetty:run</pre> 
    </div> You can then access the server by pointing your browser at the following URL: <a class="externalLink" href="http://localhost:8080/hapi-fhir-jpaserver-example/">http://localhost:8080/hapi-fhir-jpaserver-example/</a> </li> 
  </ul> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_configuring_the_jpa_server">Configuring The JPA Server</h2> 
 <p> The JPA server is configured through a series of configuration files, most of which are documented inline. </p> 
 <ul> 
  <li> <a class="externalLink" href="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-example/src/main/java/ca/uhn/fhir/jpa/demo/FhirServerConfig.java"><b>FhirServerConfig.java</b></a>: Configures the database connection settings </li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="_toc_daoconfig">DaoConfig</h2> 
 <p> The Spring confguration contains a definition for a bean called <code class="\&quot;literal\&quot;">daoConfig</code>, which will look something like the following: </p> 
 <div class="source"> 
  <pre>@Bean
public DaoConfig daoConfig() {
	DaoConfig retVal = new DaoConfig();
	retVal.setAllowMultipleDelete(true);
	retVal.setAllowInlineMatchUrlReferences(true);
	return retVal;
}</pre> 
 </div> 
 <p> You can use this method to change various configuration settings on the DaoConfig bean which define the way that the JPA server will behave. See the <a href="./apidocs-jpaserver/ca/uhn/fhir/jpa/dao/DaoConfig.html">DaoConfig JavaDoc</a> for information about the available settings. </p> 
 <div class="section"> 
  <h3 id="_toc_externalabsolute_resource_references">External/Absolute Resource References</h3> 
  <p> Clients may sometimes post resources to your server that contain absolute resource references. For example, consider the following resource: </p> 
  <div class="source"> 
   <pre>&lt;Patient xmlns="http://hl7.org/fhir"&gt;
   &lt;id value="patient-infant-01"/&gt;
   &lt;name&gt;
      &lt;use value="official"/&gt;
      &lt;family value="Miller"/&gt;
      &lt;given value="Samuel"/&gt;
   &lt;/name&gt;
   &lt;managingOrganization&gt;
      &lt;reference value="http://example.com/fhir/Organization/123"/&gt;
   &lt;/managingOrganization&gt;
&lt;/Patient&gt;</pre> 
  </div> 
  <p> By default, the server will reject this reference, as only local references are permitted by the server. This can be changed however. </p> 
  <p> If you want the server to recognize that this URL is actually a local reference (i.e. because the server will be deployed to the base URL <code class="\&quot;literal\&quot;">http://example.com/fhir/</code>) you can configure the server to recognize this URL via the following DaoConfig setting: </p> 
  <div class="source"> 
   <pre>@Bean
public DaoConfig daoConfig() {
	DaoConfig retVal = new DaoConfig();
	// ... other config ...
	retVal.getTreatBaseUrlsAsLocal().add("http://example.com/fhir/");
	return retVal;
}</pre> 
  </div> 
  <p> On the other hand, if you want the server to be configurable to allow remote references, you can set this with the confguration below. Using the <code class="\&quot;literal\&quot;">setAllowExternalReferences</code> means that it will be possible to search for references that refer to these external references. </p> 
  <div class="source"> 
   <pre>@Bean
public DaoConfig daoConfig() {
	DaoConfig retVal = new DaoConfig();
	// Allow external references
	retVal.setAllowExternalReferences(true);
	
	// If you are allowing external references, it is recommended to
	// also tell the server which references actually will be local
	retVal.getTreatBaseUrlsAsLocal().add("http://mydomain.com/fhir");
	return retVal;
}</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_logical_references">Logical References</h3> 
  <p> In some cases, you may have references which are <i>Logical References</i>, which means that they act as an identifier and not necessarily as a literal web address. </p> 
  <p> A common use for logical references is in references to conformance resources, such as ValueSets, StructureDefinitions, etc. For example, you might refer to the ValueSet <code class="\&quot;literal\&quot;">http://hl7.org/fhir/ValueSet/quantity-comparator</code> from your own resources. In this case, you are not neccesarily telling the server that this is a real address that it should resolve, but rather that this is an identifier for a ValueSet where <code class="\&quot;literal\&quot;">ValueSet.url</code> has the given URI/URL. </p> 
  <p> HAPI can be configured to treat certain URI/URL patterns as logical by using the DaoConfig#setTreatReferencesAsLogical property (see <a href="./apidocs-jpaserver/ca/uhn/fhir/jpa/dao/DaoConfig.html#setTreatReferencesAsLogical-java.util.Set-">JavaDoc</a>). For example: </p> 
  <div class="source"> 
   <div> 
    <pre>
					// Treat specific URL as logical
					myDaoConfig.getTreatReferencesAsLogical().add("http://mysystem.com/ValueSet/cats-and-dogs");
					
					// Treat all references with given prefix as logical
					myDaoConfig.getTreatReferencesAsLogical().add("http://mysystem.com/mysystem-vs-*");
				</pre> 
   </div> 
  </div> 
  <a name="search_result_caching"></a> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_search_result_caching">Search Result Caching</h3> 
  <p> By default, search results will be cached for one minute. This means that if a client performs a search for <code class="\&quot;literal\&quot;">Patient?name=smith</code> and gets back 500 results, if a client performs the same search within 60000 milliseconds the previously loaded search results will be returned again. This also means that any new Patient resources named "Smith" within the last minute will not be reflected in the results. </p> 
  <p> Under many normal scenarios this is a n acceptable performance tradeoff, but in some cases it is not. If you want to disable caching, you have two options: </p> 
  <p><b>Globally Disable / Change Caching Timeout</b></p> 
  <p> You can change the global cache using the following setting: </p> 
  <div class="source"> 
   <div> 
    <pre>
					myDaoConfig.setReuseCachedSearchResultsForMillis(null);
				</pre> 
   </div> 
  </div> 
  <p><b>Disable Cache at the Request Level</b></p> 
  <p> Clients can selectively disable caching for an individual request using the Cache-Control header: </p> 
  <div class="source"> 
   <div> 
    <pre>
					Cache-Control: no-cache
				</pre> 
   </div> 
  </div> 
  <p><b>Disable Paging at the Request Level</b></p> 
  <p> If the client knows that they will only want a small number of results (for example, a UI containing 20 results is being shown and the client knows that they will never load the next page of results) the client may also use the <code class="\&quot;literal\&quot;">nostore</code> directive along with a HAPI FHIR extension called <code class="\&quot;literal\&quot;">max-results</code> in order to specify that only the given number of results should be fetched. This directive disabled paging entirely for the request and causes the request to return immediately when the given number of results is found. This can cause a noticeable performance improvement in some cases. </p> 
  <div class="source"> 
   <div> 
    <pre>
						Cache-Control: nostore, max-results=20
					</pre> 
   </div> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_architecture">Architecture</h2> 
 <img src="images/jpa_architecture.png" alt="Architecture" align="right" class="img-fluid"> 
 <p> The HAPI JPA Server has the following components: </p> 
 <ul> 
  <li> <b>Resource Providers: </b> A RESTful server <a href="./doc_rest_server.html#resource_providers">Resource Provider</a> is provided for each resource type in a given release of FHIR. Each resource provider implements a <a href="./apidocs/ca/uhn/fhir/rest/annotation/Search.html">@Search</a> method implementing the complete set of search parameters defined in the FHIR specification for the given resource type.<br><br> The resource providers also extend a superclass which implements all of the other FHIR methods, such as Read, Create, Delete, etc.<br><br> Note that these resource providers are generated as a part of the HAPI build process, so they are not checked into Git. You can see their source in the <a href="./xref-jpaserver/">JXR Report</a>, for example the <a href="./xref-jpaserver/ca/uhn/fhir/jpa/rp/dstu2/PatientResourceProvider.html">PatientResourceProvider</a>. <br><br> The resource providers do not actually implement any of the logic in searching, updating, etc. They simply receive the incoming HTTP calls (via the RestfulServer) and pass along the incoming requests to the DAOs. <br><br> </li> 
  <li> <b>HAPI DAOs: </b> The DAOs actually implement all of the database business logic relating to the storage, indexing, and retrieval of FHIR resources, using the underlying JPA API. <br><br> </li> 
  <li> <b>Hibernate: </b> The HAPI JPA Server uses the JPA library, implemented by Hibernate. No Hibernate specific features are used, so the library should also work with other providers (e.g. Eclipselink) but it is not tested regularly with them. <br><br> </li> 
  <li> <b>Database: </b> The RESTful server uses an embedded Derby database, but can be configured to talk to <a class="externalLink" href="https://developer.jboss.org/wiki/SupportedDatabases2?_sscc=t">any database supported by Hibernate</a>. </li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="_toc_additional_information">Additional Information</h2> 
 <ul> 
  <li> <a class="externalLink" href="https://www.openhealthhub.org/t/hapi-terminology-server-uk-snomed-ct-import/592">This page</a> has information on loading national editions (UK specifically) of SNOMED CT files into the database. </li> 
 </ul> 
</div> 
<a name="upgrading"></a> 
<div class="section"> 
 <h2 id="_toc_upgrading_hapi_fhir_jpa">Upgrading HAPI FHIR JPA</h2> 
 <p> HAPI FHIR JPA is a constantly evolving product, with new features being added to each new version of the library. As a result, it is generally necessary to execute a database migration as a part of an upgrade to HAPI FHIR. </p> 
 <p> When upgrading the JPA server from one version of HAPI FHIR to a newer version, often there will be changes to the database schema. The <b>Migrate Database</b> command can be used to perform a migration from one version to the next. </p> 
 <p> Note that this feature was added in HAPI FHIR 3.5.0. It is not able to migrate from versions prior to HAPI FHIR 3.4.0. <b>Please make a backup of your database before running this command!</b> </p> 
 <p> The following example shows how to use the migrator utility to migrate between two versions. </p> 
 <div> 
  <pre>./hapi-fhir-cli migrate-database -d DERBY_EMBEDDED -u "jdbc:derby:directory:target/jpaserver_derby_files;create=true" -n "" -p "" -f V3_4_0 -t V3_5_0</pre> 
 </div> 
 <p> You may use the following command to get detailed help on the options: </p> 
 <div> 
  <pre>./hapi-fhir-cli help migrate-database</pre> 
 </div> 
 <p> Note the arguments: </p> 
 <ul> 
  <li><code class="\&quot;literal\&quot;">-d [dialect]</code> - This indicates the database dialect to use. See the detailed help for a list of options</li> 
  <li><code class="\&quot;literal\&quot;">-f [version]</code> - The version to migrate from</li> 
  <li><code class="\&quot;literal\&quot;">-t [version]</code> - The version to migrate to</li> 
 </ul> 
 <div class="section"> 
  <h3 id="_toc_oracle_support">Oracle Support</h3> 
  <p> Note that the Oracle JDBC drivers are not distributed in the Maven Central repository, so they are not included in HAPI FHIR. In order to use this command with an Oracle database, you will need to invoke the CLI as follows: </p> 
  <div> 
   <pre>java -cp hapi-fhir-cli.jar ca.uhn.fhir.cli.App migrate-database -d ORACLE_12C -u "[url]" -n "[username]" -p "[password]" -f V3_4_0 -t V3_5_0</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_migrating_340_to_350">Migrating 3.4.0 to 3.5.0+</h3> 
  <p> As of HAPI FHIR 3.5.0 a new mechanism for creating the JPA index tables (HFJ_SPIDX_xxx) has been implemented. This new mechanism uses hashes in place of large multi-column indexes. This improves both lookup times as well as required storage space. This change also paves the way for future ability to provide efficient multi-tenant searches (which is not yet implemented but is planned as an incremental improvement). </p> 
  <p> This change is not a lightweight change however, as it requires a rebuild of the index tables in order to generate the hashes. This can take a long time on databases that already have a large amount of data. </p> 
  <p> As a result, in HAPI FHIR JPA 3.6.0, an efficient way of upgrading existing databases was added. Under this new scheme, columns for the hashes are added but values are not calculated initially, database indexes are not modified on the HFJ_SPIDX_xxx tables, and the previous columns are still used for searching as was the case in HAPI FHIR JPA 3.4.0. </p> 
  <p> In order to perform a migration using this functionality, the following steps should be followed: </p> 
  <ul> 
   <li> Stop your running HAPI FHIR JPA instance (and remember to make a backup of your database before proceeding with any changes!) </li> 
   <li> Modify your <code class="\&quot;literal\&quot;">DaoConfig</code> to specify that hash-based searches should not be used, using the following setting:<br> 
    <div> 
     <pre>myDaoConfig.setDisableHashBasedSearches(true);</pre> 
    </div> </li> 
   <li> Make sure that you have your JPA settings configured to not automatically create database indexes and columns using the following setting in your JPA Properties:<br> 
    <div> 
     <pre>extraProperties.put("hibernate.hbm2ddl.auto", "none");</pre> 
    </div> </li> 
   <li> Run the database migrator command, including the entry <code class="\&quot;literal\&quot;">-x no-migrate-350-hashes</code> on the command line. For example:<br> 
    <div> 
     <pre>./hapi-fhir-cli migrate-database -d DERBY_EMBEDDED -u "jdbc:derby:directory:target/jpaserver_derby_files;create=true" -n "" -p "" -f V3_4_0 -t V3_6_0 -x no-migrate-350-hashes</pre> 
    </div> </li> 
   <li> Rebuild and start your HAPI FHIR JPA server. At this point you should have a working HAPI FHIR JPA 3.6.0 server that is is still using HAPI FHIR 3.4.0 search indexes. Search hashes will be generated for any newly created or updated data but existing data will have null hashes. </li> 
   <li> With the system running, request a complete reindex of the data in the database using an HTTP request such as the following:<br> 
    <div> 
     <pre>GET /$mark-all-resources-for-reindexing</pre> 
    </div> Note that this is a custom operation built into the HAPI FHIR JPA server. It should be secured in a real deployment, so Authentication is likely required for this call. </li> 
   <li> You can track the reindexing process by watching your server logs, but also by using the following SQL executed directly against your database: <br> 
    <div> 
     <pre>SELECT * FROM HFJ_RES_REINDEX_JOB</pre> 
    </div> When this query no longer returns any rows, the reindexing process is complete. </li> 
   <li> At this time, HAPI FHIR should be stopped once again in order to convert it to using the hash based indexes. </li> 
   <li> Modify your <code class="\&quot;literal\&quot;">DaoConfig</code> to specify that hash-based searches are used, using the following setting (this is the default setting, so it could also simply be omitted):<br> 
    <div> 
     <pre>myDaoConfig.setDisableHashBasedSearches(false);</pre> 
    </div> </li> 
   <li> Execute the migrator tool again, this time omitting the flag option, e.g.<br> 
    <div> 
     <pre>./hapi-fhir-cli migrate-database -d DERBY_EMBEDDED -u "jdbc:derby:directory:target/jpaserver_derby_files;create=true" -n "" -p "" -f V3_4_0 -t V3_6_0</pre> 
    </div> </li> 
   <li> Rebuild, and start HAPI FHIR JPA again. </li> 
  </ul> 
 </div> 
</div>                    </main>
        <div class="d-none d-sm-none d-md-none d-lg-none d-xl-block col-xl-2">
                        <div id="m-toc-sidebar" class="d-print-none m-toc-sidebar-enabled m-toc-sidebar-expanded m-toc-sidebar-autoexpandable toc-sidebar-fixed">
                <nav id="m-toc-sidebar-nav flex-column">
                <ul class="m-nav--sidebar nav flex-column flex-nowrap">
    <li class="h2">
        <a class="nav-link" href="#_toc_jpa_server" title="JPA Server">JPA Server</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_getting_started" title="Getting Started">Getting Started</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_configuring_the_jpa_server" title="Configuring The JPA Server">Configuring The JPA Server</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_daoconfig" title="DaoConfig">DaoConfig</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_externalabsolute_resource_references" title="External/Absolute Resource References">External/Absolute Resource References</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_logical_references" title="Logical References">Logical References</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_result_caching" title="Search Result Caching">Search Result Caching</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_architecture" title="Architecture">Architecture</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_additional_information" title="Additional Information">Additional Information</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_upgrading_hapi_fhir_jpa" title="Upgrading HAPI FHIR JPA">Upgrading HAPI FHIR JPA</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_oracle_support" title="Oracle Support">Oracle Support</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_migrating_340_to_350" title="Migrating 3.4.0 to 3.5.0+">Migrating 3.4.0 to 3.5.0+</a>
    </li>
    </ul>
                    </ul>
                </nav>
           </div>
            </div>
    </div> <!-- row: end -->
</div> <!-- .main-body: end -->
    <div id="m-scroll-top" style="display: none;">
        <a href="javascript:;">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
  <!-- Footer -->
  <footer class="footer-light bg-light">
    <div class="container">
        <div class="row">
        
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">HAPI FHIR                    </li>
                    <li class="nav-item " )><a     
     href="index.html"  title="Home"  class="nav-link" >Home</a></li>
                    <li class="nav-item " )><a     
     href="download.html"  title="Download"  class="nav-link" >Download</a></li>
                    <li class="nav-item " )><a     
     href="changes-report.html"  title="Changelog"  class="nav-link" >Changelog</a></li>
                    <li class="nav-item " )><a     
     href="license.html"  title="License"  class="nav-link" >License</a></li>
                    <li class="nav-header">Test Server                    </li>
                    <li class="nav-item " )><a     
     href="http://hapi.fhir.org"  title="Public Test Server"   class="externalLink nav-link" >Public Test Server</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">Using HAPI                    </li>
                    <li class="nav-item " )><a     
     href="docindex.html"  title="Documentation Index"  class="nav-link" >Documentation Index</a></li>
                    <li class="nav-item " )><a     
     href="doc_cli.html"  title="Command Line Tool (cli)"  class="nav-link" >Command Line Tool (cli)</a></li>
                    <li class="nav-header">Contribute                    </li>
                    <li class="nav-item " )><a     
     href="hacking_hapi_fhir.html"  title="Guide to Hacking HAPI"  class="nav-link" >Guide to Hacking HAPI</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">JavaDocs                    </li>
                    <li class="nav-item " )><a     
     href="apidocs/index.html"  title="Core API"  class="nav-link" >Core API</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu/index.html"  title="Model API (DSTU1)"  class="nav-link" >Model API (DSTU1)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu2/index.html"  title="Model API (DSTU2)"  class="nav-link" >Model API (DSTU2)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu3/index.html"  title="Model API (DSTU3)"  class="nav-link" >Model API (DSTU3)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-r4/index.html"  title="Model API (R4)"  class="nav-link" >Model API (R4)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-client/index.html"  title="Client API"  class="nav-link" >Client API</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-server/index.html"  title="Server API (Plain)"  class="nav-link" >Server API (Plain)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-jpaserver/index.html"  title="Server API (JPA)"  class="nav-link" >Server API (JPA)</a></li>
                    <li class="nav-header">JXR                    </li>
                    <li class="nav-item " )><a     
     href="xref-base/index.html"  title="Core"  class="nav-link" >Core</a></li>
                    <li class="nav-item " )><a     
     href="xref-jpaserver/index.html"  title="JPA Server"  class="nav-link" >JPA Server</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">Get Help                    </li>
                    <li class="nav-item " )><a     
     href="https://github.com/jamesagnew/hapi-fhir/wiki/Getting-Help"  title="How to Ask for Help (read this first!)"   class="externalLink nav-link" >How to Ask for Help (read this first!)</a></li>
                    <li class="nav-item " )><a     
     href="https://groups.google.com/d/forum/hapi-fhir"  title="Google Group (Ask Questions)"   class="externalLink nav-link" >Google Group (Ask Questions)</a></li>
                    <li class="nav-item " )><a     
     href="https://github.com/jamesagnew/hapi-fhir/issues"  title="Issue Tracker (Report Bugs/Request Features)"   class="externalLink nav-link" >Issue Tracker (Report Bugs/Request Features)</a></li>
                    <li class="nav-item " )><a     
     href="https://chat.fhir.org"  title="FHIR.org Chat (Live Chat with FHIR Implementors)"   class="externalLink nav-link" >FHIR.org Chat (Live Chat with FHIR Implementors)</a></li>
                    <li class="nav-item " )><a     
     href="hapi-fhir-faq.html"  title="Frequently Asked Questions (FAQ)"  class="nav-link" >Frequently Asked Questions (FAQ)</a></li>
                </ul>
            </div>
        <div class="col bottom-description">
            <blockquote class="blockquote">HAPI FHIR is a Java implementation of the HL7 FHIR
				(Fast Healthcare Interoperable Resources) specification.
				This project is open source (licensed under the Apache Software
				License 2.0) and 100% free to use.<br/><br/>
				<a href="https://github.com/jamesagnew/hapi-fhir"><img src="./images/github-logo-mini.png" alt="Hosted on GitHub" border="0"/></a>
				<br/>
				Star us and we will love you!<br />
				<iframe src="https://ghbtns.com/github-btn.html?user=jamesagnew&repo=hapi-fhir&type=star&count=true" frameborder="0" scrolling="0" width="100px" height="20px"></iframe></blockquote>
        </div>
      </div>
    </div>
  </footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="copyright">Copyright &copy;2014-2019                 <a href="http://www.uhn.ca">University Health Network</a>
. All Rights Reserved.</p>
        <p class="version-date">
<span class="projectVersion">Version: 3.8.0-SNAPSHOT. </span><span class="publishDate">
    Last Published: 2019-03-01
. </span>        </p>
        <p><a href="https://github.com/devacfr/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://devacfr.github.io" target="_blank" title="devacfr">devacfr</a>.</p>
      </div>
    </div>
  </div>

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/${popperVersion}/umd//popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

  <script src="./js/lightbox.min.js"></script>
      <script src="./js/reflow-skin.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
    <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>