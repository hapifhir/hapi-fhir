
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2015-07-14
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>RESTful Server - HAPI FHIR - HAPI FHIR</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta name="author" content="James Agnew" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" rel="stylesheet" />
		<link href="./css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />


		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<script src="syntaxhighlighter/shCore.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushJava.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushBash.js" type="text/javascript"></script>
<script src="syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
<link rel="stylesheet" href="syntaxhighlighter/shCore.css" type="text/css"/>
<link rel="stylesheet" href="syntaxhighlighter/shThemeDefault.css" type="text/css"/>
<link rel="shortcut icon" href="http://jamesagnew.github.io/hapi-fhir/images/favicon.png"/>
<link rel="stylesheet" href="hapi.css" type="text/css"/>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
	</head>

	<body class="page-doc_rest_server project-hapi-fhir" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="./"><span class="color-highlight">HAPI</span> FHIR</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a></li>
							<li ><a href="https://github.com/jamesagnew/hapi-fhir/" title="GitHub Project"  class="externalLink"><i class="fa fa-github"></i> GitHub Project</a></li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i>&nbsp;Documentation&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="docindex.html" title="Documentation Index">Documentation Index</a></li>
									<li ><a href="doc_intro.html" title="Introduction">Introduction</a></li>
									<li ><a href="doc_dstu2.html" title="DSTU2 Support / HL7.org Structures">DSTU2 Support / HL7.org Structures</a></li>
									<li class="dropdown-submenu ">
										<a href="doc_fhirobjects.html" title="The Data Model">The Data Model</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_fhirobjects.html" title="Working with Resources">Working with Resources</a></li>
											<li ><a href="doc_resource_references.html" title="Resource References">Resource References</a></li>
											<li ><a href="doc_extensions.html" title="Profiles & Extensions">Profiles & Extensions</a></li>
											<li ><a href="doc_tags.html" title="Tags">Tags</a></li>
											<li ><a href="doc_validation.html" title="Validation">Validation</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="doc_rest_client.html" title="RESTful Client">RESTful Client</a>
										<ul class="dropdown-menu">
											<li ><a href="doc_rest_client.html" title="Fluent/Generic Client">Fluent/Generic Client</a></li>
											<li ><a href="doc_rest_client_annotation.html" title="Annotation Client">Annotation Client</a></li>
											<li ><a href="doc_rest_client_interceptor.html" title="Interceptors (client)">Interceptors (client)</a></li>
											<li ><a href="doc_rest_client_http_config.html" title="Client HTTP Configuration">Client HTTP Configuration</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu active">
										<a href="" title="RESTful Server">RESTful Server</a>
										<ul class="dropdown-menu">
											<li class="active"><a href="" title="Using RESTful Server">Using RESTful Server</a></li>
											<li ><a href="doc_rest_operations.html" title="RESTful Operations">RESTful Operations</a></li>
											<li ><a href="doc_narrative.html" title="Narrative Generator">Narrative Generator</a></li>
											<li ><a href="doc_cors.html" title="CORS Support">CORS Support</a></li>
											<li ><a href="doc_rest_server_interceptor.html" title="Interceptors (server)">Interceptors (server)</a></li>
											<li ><a href="doc_server_tester.html" title="Web Testing UI">Web Testing UI</a></li>
										</ul>
									</li>
									<li ><a href="doc_logging.html" title="Logging">Logging</a></li>
									<li ><a href="doc_rest_etag.html" title="ETags">ETags</a></li>
									<li ><a href="doc_jpa.html" title="JPA/Database Server">JPA/Database Server</a></li>
									<li ><a href="doc_android.html" title="Android Support">Android Support</a></li>
									<li class="dropdown-submenu ">
										<a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
										<ul class="dropdown-menu">
											<li ><a href="apidocs/index.html" title="Core API">Core API</a></li>
											<li ><a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a></li>
											<li ><a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a></li>
											<li ><a href="apidocs-hl7org-dstu2/index.html" title="Model API (RI DSTU2)">Model API (RI DSTU2)</a></li>
											<li ><a href="apidocs-jpaserver/index.html" title="JPA Server API">JPA Server API</a></li>
										</ul>
									</li>
									<li ><a href="doc_tinder.html" title="Maven Plugin (hapi-tinder-plugin)">Maven Plugin (hapi-tinder-plugin)</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-support"></i>&nbsp;Get Help&nbsp;<b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)" class="externalLink">Google Group (Ask Questions)</a></li>
									<li ><a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)" class="externalLink">Issue Tracker (Report Bugs/Request Features)</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Test Server <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a></li>
									<li ><a href="doc_vagrant.html" title="Vagrant Private Test Server">Vagrant Private Test Server</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
		<div>
			<ul class="breadcrumb">
				<li><a href="index.html" title="HAPI FHIR">HAPI FHIR</a></li>
				<li  class="divider">/</li>
			<li><a href="docindex.html" title="Documentation">Documentation</a></li>
			<li  class="divider">/</li>
				<li>RESTful Server - HAPI FHIR</li>
				<li class="publishDate version-date pull-right">Last Published: 2015-07-14</li>
				<li class="divider pull-right">|</li>
				<li class="projectVersion version-date pull-right">Version: 1.2-SNAPSHOT</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<!-- The body of the document contains a number of sections --> 
<div class="section"> 
 <div class="page-header">
  <h2 id="Creating_a_RESTful_Server">Creating a RESTful Server</h2>
 </div> 
 <p> HAPI provides a built-in mechanism for adding FHIR's RESTful Server capabilities to your applications. The HAPI RESTful Server is Servlet based, so it should be easy to deploy to any of the many compliant containers that exist. </p> 
 <p> Setup is mostly done using simple annotations, which means that it should be possible to create a FHIR compliant server quickly and easily. </p> 
 <a name="resource_providers"></a> 
 <div class="section"> 
  <h3 id="Defining_Resource_Providers">Defining Resource Providers</h3> 
  <p> The first step in creating a FHIR RESTful Server is to define one or more resource providers. A resource provider is a class which is able to supply exactly one type of resource to be served up. </p> 
  <p> For example, if you wish to allow your server to serve up Patient, Observation and Location resources, you will need three resource providers. </p> 
  <p> A Resource provider class must implement the <a href="./apidocs/ca/uhn/fhir/rest/server/IResourceProvider.html">IResourceProvider</a> interface, and will contain one or more methods which have been annotated with special annotations indicating which RESTful operation that method supports. Below is a simple example of a resource provider which supports the <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#read">read</a> operation (i.e. retrieve a single resource by ID) as well as the <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#search">search</a> operation (i.e. find any resources matching a given criteria) for a specific search criteria. </p> 
  <div class="source"> 
   <pre>/**
 * All resource providers must implement IResourceProvider
 */
public class RestfulPatientResourceProvider implements IResourceProvider {

	/**
	 * The getResourceType method comes from IResourceProvider, and must
	 * be overridden to indicate what type of resource this provider
	 * supplies.
	 */
	@Override
	public Class&lt;Patient&gt; getResourceType() {
		return Patient.class;
	}
	
	/**
	 * The &quot;@Read&quot; annotation indicates that this method supports the
	 * read operation. Read operations should return a single resource
	 * instance. 
	 * 
	 * @param theId
	 *    The read operation takes one parameter, which must be of type
	 *    IdDt and must be annotated with the &quot;@Read.IdParam&quot; annotation.
	 * @return 
	 *    Returns a resource matching this identifier, or null if none exists.
	 */
	@Read()
	public Patient getResourceById(@IdParam IdDt theId) {
		Patient patient = new Patient();
		patient.addIdentifier();
		patient.getIdentifier().get(0).setSystem(new UriDt(&quot;urn:hapitest:mrns&quot;));
		patient.getIdentifier().get(0).setValue(&quot;00002&quot;);
		patient.addName().addFamily(&quot;Test&quot;);
		patient.getName().get(0).addGiven(&quot;PatientOne&quot;);
		patient.setGender(AdministrativeGenderEnum.FEMALE);
		return patient;
	}

	/**
	 * The &quot;@Search&quot; annotation indicates that this method supports the 
	 * search operation. You may have many different method annotated with 
	 * this annotation, to support many different search criteria. This
	 * example searches by family name.
	 * 
	 * @param theFamilyName
	 *    This operation takes one parameter which is the search criteria. It is
	 *    annotated with the &quot;@Required&quot; annotation. This annotation takes one argument,
	 *    a string containing the name of the search criteria. The datatype here
	 *    is StringParam, but there are other possible parameter types depending on the
	 *    specific search criteria.
	 * @return
	 *    This method returns a list of Patients. This list may contain multiple
	 *    matching resources, or it may also be empty.
	 */
	@Search()
	public List&lt;Patient&gt; getPatient(@RequiredParam(name = Patient.SP_FAMILY) StringParam theFamilyName) {
		Patient patient = new Patient();
		patient.addIdentifier();
		patient.getIdentifier().get(0).setUse(IdentifierUseEnum.OFFICIAL);
		patient.getIdentifier().get(0).setSystem(new UriDt(&quot;urn:hapitest:mrns&quot;));
		patient.getIdentifier().get(0).setValue(&quot;00001&quot;);
		patient.addName();
		patient.getName().get(0).addFamily(theFamilyName.getValue());
		patient.getName().get(0).addGiven(&quot;PatientOne&quot;);
		patient.setGender(AdministrativeGenderEnum.MALE);
		return Collections.singletonList(patient);
	}

}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Adding_more_Methods_Search_History_Create_etc">Adding more Methods (Search, History, Create, etc.)</h3> 
  <p> You will probably wish to add more methods to your resource provider. See <a href="./doc_rest_operations.html">RESTful Operations</a> for lots more examples of how to add methods for various operations. </p> 
 </div> 
 <div class="section"> 
  <h3 id="Create_a_Server">Create a Server</h3> 
  <p> Once your resource providers are created, your next step is to define a server class. </p> 
  <p> HAPI provides a class called <a href="./apidocs/ca/uhn/fhir/rest/server/RestfulServer.html">RestfulServer</a>, which is a specialized Java Servlet. To create a server, you simply create a class which extends RestfulServer as shown in the example below. </p> 
  <div class="source"> 
   <pre>/**
 * In this example, we are using Servlet 3.0 annotations to define
 * the URL pattern for this servlet, but we could also
 * define this in a web.xml file.
 */
@WebServlet(urlPatterns= {&quot;/fhir/*&quot;}, displayName=&quot;FHIR Server&quot;)
public class ExampleRestfulServlet extends RestfulServer {

	private static final long serialVersionUID = 1L;

	/**
	 * The initialize method is automatically called when the servlet is starting up, so it can
	 * be used to configure the servlet to define resource providers, or set up
	 * configuration, interceptors, etc.
	 */
   @Override
   protected void initialize() throws ServletException {
      /*
       * The servlet defines any number of resource providers, and
       * configures itself to use them by calling
       * setResourceProviders()
       */
      List&lt;IResourceProvider&gt; resourceProviders = new ArrayList&lt;IResourceProvider&gt;();
      resourceProviders.add(new RestfulPatientResourceProvider());
      resourceProviders.add(new RestfulObservationResourceProvider());
      setResourceProviders(resourceProviders);
   }
	
}
</pre> 
  </div> 
  <a name="plain_providers"></a> 
 </div> 
 <!-- NB there is an anchor for this section above --> 
 <div class="section"> 
  <h3 id="Plain_Providers_non-resource_specific">Plain Providers (non-resource specific)</h3> 
  <p> Defining one provider per resource is a good strategy to keep code readable and maintainable, but it is also possible to put methods for multiple resource types in a provider class. Providers which do not implement the <a href="./apidocs/ca/uhn/fhir/rest/server/IResourceProvider.html">IResourceProvider</a> (and therefore are not bound to one specific resource type) are known as <b>Plain Providers</b>. </p> 
  <p> A plain provider may implement any <a href="./doc_rest_operations.html">RESTful operation</a>, but will generally need to explicitly state what type of resource it applies to. If the method directly returns a resource or a collection of resources (as in an <a href="./doc_rest_operations.html#instance_read">instance read</a> or <a href="./doc_rest_operations.html#type_search">type search</a> operation) the resource type will be inferred automatically. If the method returns a <a href="./apidocs/ca/uhn/fhir/model/api/Bundle.html">Bundle</a> resource, it is necessary to explicitly specify the resource type in the method annotation. The following example shows this: </p> 
  <div class="source"> 
   <pre>public class PlainProvider {

  /**
   * This method is a Patient search, but HAPI can not automatically
   * determine the resource type so it must be explicitly stated.
   */
  @Search(type=Patient.class)
  public Bundle searchForPatients(@RequiredParam(name=Patient.SP_NAME) StringDt theName) {
    Bundle retVal = new Bundle();
    // perform search
    return retVal;
  }	
	
}
</pre> 
  </div> 
  <p> In addition, some methods are not resource specific. For example, the <a href="./doc_rest_operations.html#history">system history</a> operation returns historical versions of <b>all resource types</b> on a server, so it needs to be defined in a plain provider. </p> 
  <p> Once you have defined your plain providers, they are passed to the server in a similar way to the resource providers. </p> 
  <div class="source"> 
   <pre>public class ExampleServlet extends RestfulServer {

    /**
     * Constructor
     */
  public ExampleServlet() {
    /*
     * Plain providers are passed to the server in the same way
     * as resource providers. You may pass both resource providers
     * and and plain providers to the same server if you like. 
     */
    List&lt;Object&gt; plainProviders=new ArrayList&lt;Object&gt;();
    plainProviders.add(new PlainProvider());
    setPlainProviders(plainProviders);
    
    List&lt;IResourceProvider&gt; resourceProviders = new ArrayList&lt;IResourceProvider&gt;();
    // ...add some resource providers...
    setResourceProviders(resourceProviders);
  }
	
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Configure_the_Servers_IdentityWeb_Address">Configure the Server's Identity/Web Address</h3> 
  <p> The server will return data in a number of places that includes the complete &quot;identity&quot; of a resource. Identity in this case refers to the web address that a user can use to access the resource. </p> 
  <p> For instance, if your server is hosted at <tt>http://foo.com/fhir</tt> and your resource provider returns a Patient resource with the ID &quot;123&quot;, the server should translate that ID to &quot;http://foo.com/fhir/Patient/123&quot;. </p> 
  <p> The server will attempt to determine what the base URL should be based on what the request it receives looks like, but if it is not getting the right address you may wish to use a different &quot;address strategy&quot;. </p> 
  <p> The simplest way to do this is to configure the server to use a hardcoded base URL, which means that the server won't try to figure out the &quot;http://foo.com/fhir&quot; part of the URL but will instead just use a fixed value you supply. This is shown in the following example: </p> 
  <div class="source"> 
   <pre>    public class MyServlet extends RestfulServer {

        /**
         * Constructor
         */
        public MyServlet() {

            String serverBaseUrl = &quot;http://foo.com/fhir&quot;;
            setServerAddressStrategy(new HardcodedServerAddressStrategy(serverBaseUrl));

            // ...add some resource providers, etc...
            List&lt;IResourceProvider&gt; resourceProviders = new ArrayList&lt;IResourceProvider&gt;();
            setResourceProviders(resourceProviders);
        }

    }
</pre> 
  </div> 
  <div class="section"> 
   <h4 id="Other_Strategies">Other Strategies</h4> 
   <p> See the <a href="./apidocs/ca/uhn/fhir/rest/server/IServerAddressStrategy.html">IServerAddressStrategy</a> JavaDoc (specifically the list of &quot;All Known Implementing Classes&quot;) to see other strategies that are available. </p> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Deploy">Deploy</h3> 
  <p> Once you have created your resource providers and your restful server class, you can bundle these into a WAR file and you are ready to deploy to any JEE container (Tomcat, Websphere, Glassfish, etc). </p> 
  <p> Bundling a servlet into a WAR file and deploying it to an application server is beyond the scope of this page, but there are many good tutorials on how to do this. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="ConformanceMetadata_Statement">Conformance/Metadata Statement</h2> 
 <p> The HAPI FHIR RESTful Server will automatically export a <a class="externalLink" href="http://hl7.org/implement/standards/fhir/conformance.html">conformance statement</a>, as required by the <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#conformance">FHIR Specification</a>. </p> 
 <p> This statement is automatically generated based on the various annotated methods which are provided to the server. This behaviour may be modified by creating a new class containing a method annotated with a <a href="doc_rest_operations.html#system_conformance">@Metadata Operation</a> and then passing an instance of that class to the <a href="./apidocs/ca/uhn/fhir/rest/server/RestfulServer.html#setServerConformanceProviderjava.lang.Object">setServerConformanceProvider</a> method on your server. </p> 
 <div class="section"> 
  <h3 id="Enhancing_the_Generated_Conformance_Statement">Enhancing the Generated Conformance Statement</h3> 
  <p> If you have a need to add your own content (special extensions, etc.) to your server's conformance statement, but still want to take advantage of HAPI's automatic conformance generation, you may wish to extend <a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/rest/server/provider/ServerConformanceProvider.html">ServerConformanceProvider</a>. </p> 
  <p> In your own class extending this class, you can override the <tt>getServerConformance()</tt> method to provide your own implementation. In this method, call <tt>super.getServerConformance()</tt> to obtain the built-in conformance statement and then add your own information to it. </p> 
  <p> Note that if you are adding items during each invocation you should be aware that by default the same instance is cached by ServerConformanceProvider. This can result in an ever-growing conformance statement. You must call <tt>setCache(false);</tt> in the constructor of your new conformance provider to avoid this behaviour. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Paging_Responses">Paging Responses</h2> 
 <p> The <b>Search</b> and <b>History</b> operations both return a bundle which contain zero or more resources. FHIR RESTful servers may optionaly support paging responses, meaning that (for example) if a search returns 500 resources, the server can return a bundle containing only the first 20 and a link which will return the next 20, etc. </p> 
 <p> By default, RESTful servers will not page, but will rather return all resources immediately in a single bundle. There are two complimentary parts to the paging support: paging prividers, and bundle providers. </p> 
 <div class="section"> 
  <h3 id="Paging_Providers">Paging Providers</h3> 
  <p> To support paging, a server must have an <tt>IPagingProvider</tt> implementation set. The paging provider is used to store resource return lists between incoming calls by clients. </p> 
  <p> A paging provider provides two key methods: </p> 
  <ul> 
   <li> <tt>storeResultList</tt>, which takes a bundle provider (see below) and stores it for later retrieval. This might be by simply keeping it in memory, but it might also store it on disk, in a database, etc. This method must return a textual ID which can be used to retrieve this list later. </li> 
   <li> <tt>retrieveResultList</tt>, which takes an ID obtained by a previous call to <tt>storeResultList</tt> and returns the corresponding result list. </li> 
  </ul> 
  <p> Note that the IPagingProvider is intended to be simple and implementable and you are encouraged to provide your own implementations. </p> 
  <p> The following example shows a server implementation with paging support. </p> 
  <div class="source"> 
   <pre>public class PagingServer extends RestfulServer {

	public PagingServer() {
		
		/*
		 * Set the resource providers as always. Here we are using the paging
		 * provider from the example below, but it is not strictly neccesary
		 * to use a paging resource provider as well. If a normal resource 
		 * provider is used (one which returns List&lt;?&gt; instead of IBundleProvider)
		 * then the loaded resources will be stored by the IPagingProvider.
		 */
		setResourceProviders(new PagingPatientProvider());
		
		/*
		 * Set a paging provider. Here a simple in-memory implementation
		 * is used, but you may create your own. 
		 */
		FifoMemoryPagingProvider pp = new FifoMemoryPagingProvider(10);
		pp.setDefaultPageSize(10);
		pp.setMaximumPageSize(100);
		setPagingProvider(pp);
				
	}

}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Bundle_Providers">Bundle Providers</h3> 
  <p> If a server supports a paging provider, a further optimization is to also use a bundle provider. A bundle provider simply takes the place of the <tt>List&lt;IResource&gt;</tt> return type in your provider methods. </p> 
  <p> When using a bundle provider however, the server will only request small sublists of resources as they are actually being returned. This allows servers to optimize by not loading all resources into memory until they are actually needed. </p> 
  <p> One implementation of a bundle provider is shown below. This provider example works by only keeping the resource IDs in memory, but there are other possible implementation strategies that would work as well. </p> 
  <p> Note that the IBundleProvider is intended to be simple and implementable and you are encouraged to provide your own implementations. </p> 
  <div class="source"> 
   <pre>public class PagingPatientProvider implements IResourceProvider {

	/**
	 * Search for Patient resources matching a given family name 
	 */
	@Search
	public IBundleProvider search(@RequiredParam(name = Patient.SP_FAMILY) StringParam theFamily) {
		final InstantDt searchTime = InstantDt.withCurrentTime();

		/*
		 * First, we'll search the database for a set of database row IDs that
		 * match the given search criteria. That way we can keep just the
		 * row IDs around, and load the actual resources on demand later 
		 * as the client pages through them.
		 */
		final List&lt;Long&gt; matchingResourceIds = null; // &lt;-- implement this

		/*
		 * Return a bundle provider which can page through the IDs and
		 * return the resources that go with them.
		 */
		return new IBundleProvider() {

			@Override
			public int size() {
				return matchingResourceIds.size();
			}

			@Override
			public List&lt;IBaseResource&gt; getResources(int theFromIndex, int theToIndex) {
				int end = Math.max(theToIndex, matchingResourceIds.size() - 1);
				List&lt;Long&gt; idsToReturn = matchingResourceIds.subList(theFromIndex, end);
				return loadResourcesByIds(idsToReturn);
			}

			@Override
			public InstantDt getPublished() {
				return searchTime;
			}

         @Override
         public Integer preferredPageSize() {
            // Typically this method just returns null
            return null;
         }
		};
	}

	/**
	 * Load a list of patient resources given their IDs
	 */
	private List&lt;IBaseResource&gt; loadResourcesByIds(List&lt;Long&gt; theIdsToReturn) {
		// .. implement this search against the database ..
		return null;
	}

	@Override
	public Class&lt;? extends IResource&gt; getResourceType() {
		return Patient.class;
	}

}
</pre> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Common_Method_Parameters">Common Method Parameters</h2> 
 <p> Different RESTful methods will have different requirements in terms of the method parameters they require, as described in the <a href="./doc_rest_operations.html">RESTful Operations</a> page. </p> 
 <p> In addition, there are several parameters you may add in order to meet specific needs of your application. </p> 
 <div class="section"> 
  <h3 id="Accessing_the_underlying_Servlet_RequestResponse">Accessing the underlying Servlet Request/Response</h3> 
  <p> In some cases, it may be useful to have access to the underlying HttpServletRequest and/or HttpServletResponse objects. These may be added by simply adding one or both of these objects as method parameters. </p> 
  <div class="source"> 
   <pre>@Search
public List&lt;Patient&gt; findPatients(
		@RequiredParam(name=&quot;foo&quot;) StringParam theParameter,
		HttpServletRequest theRequest, 
		HttpServletResponse theResponse) {
 List&lt;Patient&gt; retVal=new ArrayList&lt;Patient&gt;(); // populate this
 return retVal;
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Accessing_the__narrative_parameter_value">Accessing the _narrative parameter value</h3> 
  <p> There are different ways of <a href="./doc_narrative.html">generating narratives</a> for use on your server. HAPI's Server also provides a non-standard parameter called <tt>_narrative</tt> which can be used to control narrative behavour. If you add a parameter to any server (or annotation client) method with a type of <tt>NarrativeModeEnum</tt>, the value will be populated with the value of this URL parameter. </p> 
 </div> 
</div> 
<!-- <section name="Security">
			
			<p>
				Naturally, security is a prime concern
			</p>
		
		</section> --> 
<div class="section"> 
 <h2 id="ExceptionError_Handling">Exception/Error Handling</h2> 
 <p> Within your RESTful operations, you will generally be returning resources or bundles of resources under normal operation. During execution you may also need to propagate errors back to the client for a variety of reasons. </p> 
 <div class="section"> 
  <h3 id="Automatic_Exception_Handling">Automatic Exception Handling</h3> 
  <p> By default, HAPI generates appropriate error responses for a several built-in conditions. For example, if the user makes a request for a resource type that does not exist, or tries to perform a search using an invalid parameter, HAPI will automatically generate an <tt>HTTP 400 Invalid Request</tt>, and provide an OperationOutcome resource as response containing details about the error. </p> 
  <p> Similarly, if your method implementation throws any exceptions (checked or unchecked) instead of returning normally, the server will usually* automatically generate an <tt>HTTP 500 Internal Error</tt> and generate an OperationOutcome with details about the exception. </p> 
  <p> <i>* Note that certain exception types will generate other response codes, as explained below.</i> </p> 
 </div> 
 <div class="section"> 
  <h3 id="Generating_Specific_HTTP_Error_Responses">Generating Specific HTTP Error Responses</h3> 
  <p> In many cases, you will want to respond to client requests with a specific HTTP error code (and possibly your own error message too). Sometimes this is a requirement of the FHIR specification (e.g. the &quot;validate&quot; operation requires a response of <tt>HTTP 422 Unprocessable Entity</tt> if the validation fails). Sometimes this is simply a requirement of your specific application (e.g. you want to provide application specific HTTP status codes for certain types of errors) </p> 
  <p> To customize the error that is returned by HAPI's server methods, you must throw an exception which extends HAPI's <a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a> class. Various exceptions which extend this class will generate a different HTTP status code. </p> 
  <p> For example, the <a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/rest/server/exceptions/ResourceNotFoundException.html">ResourceNotFoundException</a> causes HAPI to return an <tt>HTTP 404 Resource Not Found</tt>. A complete list of available exceptions is available <a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/rest/server/exceptions/package-summary.html">here</a>. </p> 
  <p> If you wish to return an HTTP status code for which there is no pre-defined exception, you may throw the <a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/rest/server/exceptions/UnclassifiedServerFailureException.html">UnclassifiedServerFailureException</a>, which allows you to return any status code you wish. </p> 
 </div> 
 <div class="section"> 
  <h3 id="Returning_an_OperationOutcome_for_Errors">Returning an OperationOutcome for Errors</h3> 
  <p> By default, HAPI will automatically generate an OperationOutcome which contains details about the exception that was thrown. You may wish to provide your own OperationOutcome instead. In this case, you may pass one into the constructor of the exception you are throwing. </p> 
  <div class="source"> 
   <pre>@Read
public Patient read(@IdParam IdDt theId) {
   if (databaseIsDown) {
      OperationOutcome oo = new OperationOutcome();
      oo.addIssue().setSeverity(IssueSeverityEnum.FATAL).setDetails(&quot;Database is down&quot;);
      throw new InternalErrorException(&quot;Database is down&quot;, oo);
   }
   
   Patient patient = new Patient(); // populate this
   return patient;
}
</pre> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Using_the_Server">Using the Server</h2> 
 <p> Your RESTful server should now support the methods you have declared. Here are a few helpful tricks for interacting with the server: </p> 
 <p> <b>Pretty Printing:</b> The HAPI RESTful server supports a non-standard parameter called <tt>_pretty</tt>, which can be used to request that responses be pretty-printed (indented for easy reading by humans) by setting the value to <tt>true</tt>. This can be useful in testing. An example URL for this might be:<br /> <tt>http://example.com/fhir/Patient/_search?name=TESTING&amp;_pretty=true</tt> </p> 
</div> 
<div class="section"> 
 <h2 id="Populating_Resource_Metadata">Populating Resource Metadata</h2> 
 <p> Server operations will often return a resource or a bundle of resources. These types will contain one or more resource instances, but also specify a set of metadata describing that resource. </p> 
 <p> For example, resources have a &quot;published&quot; and &quot;updated&quot; date, referring to the date/time the resource was originally created and the date/time the resource was last updated respectively. For operations which return a single resource, these values are returned via HTTP headers. For operations which return a bundle, these values are returned via elements within the bundle's &quot;entry&quot; tag. </p> 
 <p> Bundles may also contain a set of links, such as an &quot;alternate&quot; link to a resource, or a &quot;search&quot; link. </p> 
 <p> Populating these metadata elements is done via the <tt><a class="externalLink" href="http://jamesagnew.github.io/hapi-fhir/apidocs/ca/uhn/fhir/model/api/IResource.html#getResourceMetadata()">IResource#getResourceMetadata()</a></tt> method. The following example shows how to set various metadata elements on a resource being returned. </p> 
 <div class="source"> 
  <pre>@Search
public List&lt;Patient&gt; getAllPatients() {
   ArrayList&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
   
   // Create a patient to return
   Patient patient = new Patient();
   retVal.add(patient);
   patient.setId(&quot;Patient/123&quot;);
   patient.addName().addFamily(&quot;Smith&quot;).addGiven(&quot;John&quot;);
   
   // Create a tag list and add it to the resource
   TagList tags = new TagList();
   tags.addTag(Tag.HL7_ORG_FHIR_TAG, &quot;http://foo/tag1.html&quot;, &quot;Some tag&quot;);
   tags.addTag(Tag.HL7_ORG_FHIR_TAG, &quot;http://foo/tag2.html&quot;, &quot;Another tag&quot;);
   ResourceMetadataKeyEnum.TAG_LIST.put(patient, tags);
   
   // Set some links (these can be provided as relative links or absolute)
   // and the server will convert to absolute as appropriate
   String linkAlternate = &quot;Patient/7736&quot;;
   ResourceMetadataKeyEnum.LINK_ALTERNATE.put(patient, linkAlternate);
   String linkSearch = &quot;Patient?name=smith&amp;name=john&quot;;
   ResourceMetadataKeyEnum.LINK_SEARCH.put(patient, linkSearch);
   
   // Set the published and updated dates
   InstantDt pubDate = new InstantDt(&quot;2011-02-22&quot;);
   ResourceMetadataKeyEnum.PUBLISHED.put(patient, pubDate);
   InstantDt updatedDate = new InstantDt(&quot;2014-07-12T11:22:27Z&quot;);
   ResourceMetadataKeyEnum.UPDATED.put(patient, updatedDate);
   
   // Set the resource title (note that if you are using HAPI's narrative
   // generation capability, the narrative generator will often create
   // useful titles automatically, and the server will create a default
   // title if none is provided)
   String title = &quot;Patient John SMITH&quot;;
   ResourceMetadataKeyEnum.TITLE.put(patient, title);
   
   return retVal;
}
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Server_Lifecycle_Methods">Server Lifecycle Methods</h2> 
 <p> Resource providers may optionally want to be notified when the server they are registered with is being destroyed, so that they can perform cleanup. In this case, a method annotated with the <tt>@Destroy</tt> annotation can be added (this method should be public, return <tt>void</tt>, and take no parameters). </p> 
 <p> This method will be invoked once by the RestfulServer when it is shutting down. </p> 
</div> 
<div class="section"> 
 <h2 id="A_Complete_Example">A Complete Example</h2> 
 <p> A complete example showing how to implement a RESTful server can be found in our Git repo here: <a class="externalLink" href="https://github.com/jamesagnew/hapi-fhir/tree/master/restful-server-example">https://github.com/jamesagnew/hapi-fhir/tree/master/restful-server-example</a> </p> 
 <p> Hopefully this will be available as a separate download soon, but currently it may be used to demonstrate a fully working server project. </p> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#Creating_a_RESTful_Server" title="Creating a RESTful Server">Creating a RESTful Server <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Defining_Resource_Providers" title="Defining Resource Providers">Defining Resource Providers</a>
		<li><a href="#Adding_more_Methods_Search_History_Create_etc" title="Adding more Methods (Search, History, Create, etc.)">Adding more Methods (Search, History, Create, etc.)</a>
		<li><a href="#Create_a_Server" title="Create a Server">Create a Server</a>
		<li><a href="#Plain_Providers_non-resource_specific" title="Plain Providers (non-resource specific)">Plain Providers (non-resource specific)</a>
		<li class="dropdown"><a href="#Configure_the_Servers_IdentityWeb_Address" title="Configure the Server's Identity/Web Address">Configure the Server's Identity/Web Address <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Other_Strategies" title="Other Strategies">Other Strategies</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Deploy" title="Deploy">Deploy</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#ConformanceMetadata_Statement" title="Conformance/Metadata Statement">Conformance/Metadata Statement <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Enhancing_the_Generated_Conformance_Statement" title="Enhancing the Generated Conformance Statement">Enhancing the Generated Conformance Statement</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#Paging_Responses" title="Paging Responses">Paging Responses <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Paging_Providers" title="Paging Providers">Paging Providers</a>
		<li><a href="#Bundle_Providers" title="Bundle Providers">Bundle Providers</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#Common_Method_Parameters" title="Common Method Parameters">Common Method Parameters <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Accessing_the_underlying_Servlet_RequestResponse" title="Accessing the underlying Servlet Request/Response">Accessing the underlying Servlet Request/Response</a>
		<li><a href="#Accessing_the__narrative_parameter_value" title="Accessing the _narrative parameter value">Accessing the _narrative parameter value</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#ExceptionError_Handling" title="Exception/Error Handling">Exception/Error Handling <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Automatic_Exception_Handling" title="Automatic Exception Handling">Automatic Exception Handling</a>
		<li><a href="#Generating_Specific_HTTP_Error_Responses" title="Generating Specific HTTP Error Responses">Generating Specific HTTP Error Responses</a>
		<li><a href="#Returning_an_OperationOutcome_for_Errors" title="Returning an OperationOutcome for Errors">Returning an OperationOutcome for Errors</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Using_the_Server" title="Using the Server">Using the Server</a>
		<li><a href="#Populating_Resource_Metadata" title="Populating Resource Metadata">Populating Resource Metadata</a>
		<li><a href="#Server_Lifecycle_Methods" title="Server Lifecycle Methods">Server Lifecycle Methods</a>
		<li><a href="#A_Complete_Example" title="A Complete Example">A Complete Example</a>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">HAPI FHIR</li>
						<li >
							<a href="index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="download.html"  title="Download"><i class="fa fa-download"></i> Download</a>
						</li>
						<li >
							<a href="changes-report.html" title="Changelog">Changelog</a>
						</li>
						<li >
							<a href="license.html" title="License">License</a>
						</li>
						<li class="nav-header">Test Server</li>
						<li >
							<a href="http://fhirtest.uhn.ca" title="Public Test Server" class="externalLink">Public Test Server</a>
						</li>
						<li >
							<a href="doc_vagrant.html" title="Vagrant Private Test Server">Vagrant Private Test Server</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Using HAPI</li>
						<li >
							<a href="docindex.html" title="Documentation Index">Documentation Index</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">JavaDocs</li>
						<li >
							<a href="apidocs/index.html" title="Core API">Core API</a>
						</li>
						<li >
							<a href="apidocs-dstu/index.html" title="Model API (DSTU1)">Model API (DSTU1)</a>
						</li>
						<li >
							<a href="apidocs-dstu2/index.html" title="Model API (DSTU2)">Model API (DSTU2)</a>
						</li>
						<li class="nav-header">JXR</li>
						<li >
							<a href="xref-base/index.html" title="Core">Core</a>
						</li>
						<li >
							<a href="xref-jpaserver/index.html" title="JPA Server">JPA Server</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Get Help</li>
						<li >
							<a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)" class="externalLink">Google Group (Ask Questions)</a>
						</li>
						<li >
							<a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)" class="externalLink">Issue Tracker (Report Bugs/Request Features)</a>
						</li>
						<li class="nav-header">Maven Reports</li>
						<li >
							<a href="team-list.html" title="Project Developers">Project Developers</a>
						</li>
						<li >
							<a href="cobertura/index.html" title="Cobertura (Test Coverage)">Cobertura (Test Coverage)</a>
						</li>
						<li >
							<a href="surefire-report.html" title="Surefire (Test Status)">Surefire (Test Status)</a>
						</li>
						<li >
							<a href="findbugs.html" title="FindBugs">FindBugs</a>
						</li>
						<li >
							<a href="checkstyle.html" title="Checkstyle">Checkstyle</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>HAPI FHIR is a Java implementation of the HL7 FHIR
				(Fast Healthcare Interoperable Resources) specification.
				This project is open source (licensed under the Apache Software
				License 2.0) and 100% free to use.<br/><br/>
				<a href="https://github.com/jamesagnew/hapi-fhir"><img src="./images/github-logo-mini.png" alt="Hosted on GitHub" border="0"/></a>
				<br/>
				Star us and we will love you!<br />
				<iframe src="http://ghbtns.com/github-btn.html?user=jamesagnew&repo=hapi-fhir&type=star&count=true" frameborder="0" scrolling="0" width="100px" height="20px"></iframe></blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014-2015 <a href="http://www.uhn.ca">University Health Network</a>. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>

	<script src="./js/reflow-skin.js"></script>

	<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>
